
CREATE PROCEDURE [dbo].[RECUP_ESTIA_PATRIMOINE]
AS
BEGIN

DECLARE @ID_LOG INT, @NB INT

--AGENCE: TABLE DES AGENCES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('AGENCE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_AGENCE
INSERT INTO ESTIA_AGENCE (CORG, CAGENCE, LAGENCE, RSOC, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELEX, TELPH, FAX, CONTACT, CFONCTIO, TEMPATRI, COTIERS, TRIG, COTYPTIERS, TXBIBLITA, CEMPLOY, NUMAGENCE, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, ADRCOMP, CEMPLOY2, ORG_ID, AGENCE_ID, ADRESSE_ID, REFERENCE)
SELECT CORG, CAGENCE, LAGENCE, RSOC, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELEX, TELPH, FAX, CONTACT, CFONCTIO, TEMPATRI, COTIERS, TRIG, COTYPTIERS, TXBIBLITA, CEMPLOY, NUMAGENCE, PEGAS, TRIGD, 0OMBMP, XPLAN, YPLAN, LPLAN, HPLAN, ADRCOMP, CEMPLOY2, ORG_ID, AGENCE_ID, ADRESSE_ID, REFERENCE
FROM ESTIA_SOURCE..AGENCE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--APE: TABLE DES CODES APE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('APE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_APE
INSERT INTO ESTIA_APE (CAPE, LAPE, TRIG, LACTIF)
SELECT CAPE, LAPE, TRIG, LACTIF
FROM ESTIA_SOURCE..APE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--ESTIA_AVENAN: TABLE DES ESTIA_AVENANTS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('ESTIA_AVENAN', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_AVENAN
INSERT INTO ESTIA_AVENAN (CORG, CCONTFRS, CNATECH, DCREAT, DSIGN, MTHT, MTVA, MTTC, CSTE, VALIDE, DETAT, SIGAUTORISE)
SELECT CORG, CCONTFRS, CNATECH, DCREAT, DSIGN, REPLACE(MTHT, ',','.') AS MTHT, REPLACE(MTVA, ',','.') AS MTVA, REPLACE(MTTC, ',','.') AS MTTC, CSTE, VALIDE, DETAT, SIGAUTORISE
FROM ESTIA_SOURCE..AVENAN
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--BANQUE: TABLE DES BANQUES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('BANQUE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_BANQUE
INSERT INTO ESTIA_BANQUE (CBANQUE, DECOUV, AGIOS, RESPONS, COMPTE, TYPBQ, CMODREG, BGTYPTIERS, BGTIERS, TRIGD, LBANQUE, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELPH, TELEX, FAX, TRIG, ADRCOMP, MIGCOMPT, BIC, LACTIF, CPAYSBIC, BIC8)
SELECT CBANQUE, DECOUV, AGIOS, RESPONS, COMPTE, TYPBQ, CMODREG, BGTYPTIERS, BGTIERS, TRIGD, LBANQUE, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELPH, TELEX, FAX, TRIG, ADRCOMP, MIGCOMPT, BIC, LACTIF, CPAYSBIC, BIC8
FROM ESTIA_SOURCE..BANQUE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--BANALDET: TABLE BANAL DETAIL
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('BANALDET', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_BANALDET
INSERT INTO ESTIA_BANALDET (CSTE, CORG, ZONCLE1, ZONCLE2, ZONCLE3, ZONCLE4, ZONCLE5, CHAR01, CHAR02, CHAR03, CHAR04, CHAR05, NUM01, NUM02, NUM03, NUM04, NUM05, DATE01, DATE02, DATE03, DATE04, DATE05, BANALDET_ID)
SELECT CSTE, CORG, ZONCLE1, ZONCLE2, ZONCLE3, ZONCLE4, ZONCLE5, CHAR01, CHAR02, CHAR03, CHAR04, CHAR05, NUM01, NUM02, NUM03, NUM04, NUM05, DATE01, DATE02, DATE03, DATE04, DATE05, BANALDET_ID
FROM ESTIA_SOURCE..BANALDET
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--BASE: TABLE DE BASE DES TANTIEMES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('BASE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_BASE
INSERT INTO ESTIA_BASE (CBASE, LBASE, TRIG, CORG, CAGENCE, CGROUPE, TBASE, REGROUP1, REGROUP2, MIGCOMPT, GROUPE_ID, LACTIF)
SELECT CBASE, LBASE, TRIG, ISNULL(CORG, '') AS CORG, ISNULL(CAGENCE, '') AS CAGENCE, ISNULL(CGROUPE, '') AS CGROUPE, TBASE, REGROUP1, REGROUP2, MIGCOMPT, GROUPE_ID, LACTIF
FROM ESTIA_SOURCE..BASE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--BASELOC: TABLE DES TANTIEMES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('BASELOC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_BASELOC
INSERT INTO ESTIA_BASELOC (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CBASE, TRIG, MONTANT, DEFFET, MIGCOMPT, LOCAL_ID)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CBASE, TRIG, REPLACE(MONTANT, ',','.') AS MONTANT, 
ISNULL(RIGHT(DEFFET, 2), '00') + ISNULL(SUBSTRING(DEFFET, 4, 2), '01') + ISNULL(LEFT(DEFFET, 2), '01') AS DEFFET, MIGCOMPT, LOCAL_ID
FROM ESTIA_SOURCE..BASELOC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CATEG: TABLE DES CATEGORIES DE TIERS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CATEG', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CATEG
INSERT INTO ESTIA_CATEG (LISTORG, CCATEG, LCATEG, CTYPTIERS, FJOURNAL, AJOURNAL, DERCLO, BALEDIT, XJOURNAL, TRIG, LACTIF)
SELECT LISTORG, CCATEG, LCATEG, CTYPTIERS, FJOURNAL, AJOURNAL, DERCLO, BALEDIT, XJOURNAL, TRIG, LACTIF
FROM ESTIA_SOURCE..CATEG
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--COMMENT_: TABLE DES COMMENTAIRES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('COMMENT_', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_COMMENT
INSERT INTO ESTIA_COMMENT (NOFICH, CLEFICH, COMMENT_, NPAGE, AUTEUR, DCREA, DPREV, DREEL, TYPE, ETAT, REFER, INTERLOC, SECTEUR, DEST, SUP, MODIF,DAVIS, DBANAL, MONTANT, BANAL, MOTCLE, CLE2, HEURE, DMODIF, POSTE, CCATCOMMENT, LIBELLE, NIVEAU, UTIL)
SELECT NOFICH, CLEFICH, COMMENT, NPAGE, AUTEUR, DCREA, DPREV, DREEL, TYPE, ETAT, REFER, INTERLOC, SECTEUR, DEST, SUP, MODIF, DAVIS, DBANAL, MONTANT, BANAL, MOTCLE, CLE2, HEURE, DMODIF, POSTE, CCATCOMMENT, LIBELLE, NIVEAU, UTIL
FROM ESTIA_SOURCE..COMMENT_
where nofich <> 'IREPRSNE' and clefich not in ('000002149800001', '0000021398', '0000021498')
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CTRTIERS: TABLE DES CONTRATS PAR TIERS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CTRTIERS', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CTRTIERS
INSERT INTO ESTIA_CTRTIERS (CMODINT, CTIERS, CCONTFRS, DURINIT, LCTRTIERS, DCTRTIERS, DDEBVAL, DFINVAL, CORG, LOCAT, CCONTPREST, CFREQINT, DURCONT, DURPREAV, DFPERESS, TRIG, SUIVICO, DLIMPREST, CUNITE, CEMPLOY, CPENAL, CPERFAC, TERME, DRADIAT, CMOTRAD, FOURNITURE, BT, ENTRETIEN, CTEQUI, DATCOM, DELAI, HEUROUV, CCONTPRIX, DPREVINT, DDEBPREV, AVECAO, CONSO, TYPCONT, HMARCHE, CMODPASS, ECART, DATREPORT, RENOUV, POURC, AGEAUT, MTPLURI, CONTROLE, TACITE, CNATPRES, GESTIONHT, CBANQUE, CGUICHET, COMPTE, CLE, MODTVA, PCONTFRS, CCATEG, CODNAT, CLEIBAN, COORDBANQ_ID, LIBFAC, SIGAUTORISE)
SELECT CMODINT, CTIERS, CCONTFRS, DURINIT, LCTRTIERS, DCTRTIERS, 
CASE WHEN LEN(DDEBVAL) = 8 AND ISDATE(SUBSTRING(DDEBVAL, 7, 2) + substring(DDEBVAL, 4, 2) + substring(DDEBVAL, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DDEBVAL, 7, 2) + substring(DDEBVAL, 4, 2) + substring(DDEBVAL, 1, 2), 103)
	 WHEN LEN(DDEBVAL) = 10 AND ISDATE(substring(DDEBVAL, 7, 4) + substring(DDEBVAL, 4, 2) + substring(DDEBVAL, 1, 2)) = 1 THEN convert(datetime, substring(DDEBVAL, 7, 4) + substring(DDEBVAL, 4, 2) + substring(DDEBVAL, 1, 2), 103) END AS DDEBVAL, 
CASE WHEN LEN(DFINVAL) = 8 AND ISDATE(SUBSTRING(DFINVAL, 7, 2) + substring(DFINVAL, 4, 2) + substring(DFINVAL, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DFINVAL, 7, 2) + substring(DFINVAL, 4, 2) + substring(DFINVAL, 1, 2), 103)
	 WHEN LEN(DFINVAL) = 10 AND ISDATE(substring(DFINVAL, 7, 4) + substring(DFINVAL, 4, 2) + substring(DFINVAL, 1, 2)) = 1 THEN convert(datetime, substring(DFINVAL, 7, 4) + substring(DFINVAL, 4, 2) + substring(DFINVAL, 1, 2), 103) END AS DFINVAL, 
CORG, LOCAT, CCONTPREST, CFREQINT, DURCONT, DURPREAV, DFPERESS, TRIG, SUIVICO, 
CASE WHEN LEN(DLIMPREST) = 8 AND ISDATE(SUBSTRING(DLIMPREST, 7, 2) + substring(DLIMPREST, 4, 2) + substring(DLIMPREST, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DLIMPREST, 7, 2) + substring(DLIMPREST, 4, 2) + substring(DLIMPREST, 1, 2), 103)
	 WHEN LEN(DLIMPREST) = 10 AND ISDATE(substring(DLIMPREST, 7, 4) + substring(DLIMPREST, 4, 2) + substring(DLIMPREST, 1, 2)) = 1 THEN convert(datetime, substring(DLIMPREST, 7, 4) + substring(DLIMPREST, 4, 2) + substring(DLIMPREST, 1, 2), 103) END AS DLIMPREST, 
CUNITE, CEMPLOY, CPENAL, CPERFAC, TERME, DRADIAT, CMOTRAD, FOURNITURE, BT, ENTRETIEN, CTEQUI, DATCOM, DELAI, HEUROUV, CCONTPRIX, DPREVINT, 
CASE WHEN LEN(DDEBPREV) = 8 AND ISDATE(SUBSTRING(DDEBPREV, 7, 2) + substring(DDEBPREV, 4, 2) + substring(DDEBPREV, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DDEBPREV, 7, 2) + substring(DDEBPREV, 4, 2) + substring(DDEBPREV, 1, 2), 103)
	 WHEN LEN(DDEBPREV) = 10 AND ISDATE(substring(DDEBPREV, 7, 4) + substring(DDEBPREV, 4, 2) + substring(DDEBPREV, 1, 2)) = 1 THEN convert(datetime, substring(DDEBPREV, 7, 4) + substring(DDEBPREV, 4, 2) + substring(DDEBPREV, 1, 2), 103) END AS DDEBPREV, 
AVECAO, CONSO, TYPCONT, HMARCHE, CMODPASS, REPLACE(ECART, ',','.') AS ECART, DATREPORT, RENOUV, POURC, AGEAUT, REPLACE(MTPLURI, ',','.') AS MTPLURI, CONTROLE, TACITE, CNATPRES, GESTIONHT, CBANQUE, CGUICHET, COMPTE, CLE, MODTVA, PCONTFRS, CCATEG, CODNAT, CLEIBAN, COORDBANQ_ID, LIBFAC, SIGAUTORISE
FROM ESTIA_SOURCE..CTRTIERS
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--BAIL: TABLE DES NATURES DE BAIL
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('BAIL', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_BAIL
INSERT INTO ESTIA_BAIL (CBAIL, LBAIL, APLBAIL, DNUMI, DERTERM, DURBAIL, DURPREAV, FINMOIS, POURDG, CNUMI, TRIG, CQUABAIL, PEREVISION, DGREV, TEMINFO, CEPVAR, BEPVAR, REPVAR, DELREL, TAUXRED, INTRET, LACTIF)
SELECT CBAIL, LBAIL, APLBAIL, DNUMI, DERTERM, DURBAIL, DURPREAV, FINMOIS, POURDG, CNUMI, TRIG, CQUABAIL, PEREVISION, DGREV, TEMINFO, CEPVAR, BEPVAR, REPVAR, DELREL, TAUXRED, INTRET, LACTIF
FROM ESTIA_SOURCE..BAIL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--COMPTE: TABLE DES COMPTES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('COMPTE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_COMPTE
INSERT INTO ESTIA_COMPTE (CORG, CCOMPTE, CQC, NOM, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELPH, MONDERQ, LOYER, SDAVQUIT, DATPLAN, CMODPLAN, CCATRET, DPRET, COPRO, CODBAR, DATDERQUIT, DERAPL, DEMISAVIS, SEMISAVIS, DATDEN, DIMPQUITT, MTPREL, MONRAP, DDEBDEN1, DFINDEN1, DDEBDEN2, DFINDEN2, TRUET, TLIEUDIT, TCPOS, TVILLE, TCOMM, TTELPH, DATDEB, DATFIN, TRIG, CCATMENPDR, CCATMENSLS, REFDEROG, CMOTDERO, DDEROG, DEPASS, DEBPASS, DFINPASS, TEMPLOY, MTCRDTP, MTCRDTC, CPAYS, TCPAYS, ADRCOMP, TADRCOMP, CQC2, NOM2, CONVOC, NIVAPP, MIGCOMPT, RESIDENT, CCQC1, CNOM1, CCQC2, CNOM2, CLIEUDIT, CADRCOMP, CRUE, CCPOS, CVILLE, CCOMCONV, PAYSCONV, CPAYSCON, EXTIDENT, EXTPASSE, EXTACC, EXTVER)
SELECT CORG, CCOMPTE, CQC, NOM, RUE, LIEUDIT, CPOS, VILLE, CCOMM, TELPH, MONDERQ, LOYER, SDAVQUIT, DATPLAN, CMODPLAN, CCATRET, DPRET, COPRO, CODBAR, DATDERQUIT, DERAPL, DEMISAVIS, SEMISAVIS, DATDEN, DIMPQUITT, MTPREL, MONRAP, DDEBDEN1, DFINDEN1, DDEBDEN2, DFINDEN2, TRUET, TLIEUDIT, TCPOS, TVILLE, TCOMM, TTELPH, DATDEB, DATFIN, TRIG, CCATMENPDR, CCATMENSLS, REFDEROG, CMOTDERO, DDEROG, DEPASS, DEBPASS, DFINPASS, TEMPLOY, MTCRDTP, MTCRDTC, CPAYS, TCPAYS, ADRCOMP, TADRCOMP, CQC2, NOM2, CONVOC, NIVAPP, MIGCOMPT, RESIDENT, CCQC1, CNOM1, CCQC2, CNOM2, CLIEUDIT, CADRCOMP, CRUE, CCPOS, CVILLE, CCOMCONV, PAYSCONV, CPAYSCON, EXTIDENT, EXTPASSE, EXTACC, EXTVER
FROM ESTIA_SOURCE..COMPTE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CONTNAT: TABLE DES NATURES TECHNIQUES DES CONTRATS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CONTNAT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CONTNAT
INSERT INTO ESTIA_CONTNAT (CORG ,MTTC ,MENSUEL ,CCONTFRS ,CRUB ,CNATECH ,MTHT ,TVA ,DORIG,PF ,DDREVIS ,TRIG ,DSIGN ,MTREVIS ,ANCREVI ,CTVA ,RABAIS ,DATREP ,MTMINI ,VALIDE ,DETAT ,CNOMENM ,MOISREV ,REVCRIT ,DPECFNP)
SELECT CORG , REPLACE(MTTC, ',','.') AS MTTC ,MENSUEL ,CCONTFRS ,CRUB ,CNATECH ,REPLACE(MTHT, ',','.') AS MTHT ,REPLACE(TVA, ',','.') AS TVA ,
DORIG,PF , DDREVIS ,TRIG ,DSIGN ,REPLACE(MTREVIS, ',','.') AS MTREVIS ,ANCREVI ,CTVA ,RABAIS ,DATREP ,MTMINI ,VALIDE ,DETAT ,CNOMENM ,MOISREV ,REVCRIT ,DPECFNP
FROM ESTIA_SOURCE..CONTNAT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--COORDBANQ: TABLE DES COORDONNEES BANQUAIRES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('COORDBANQ', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_COORDBANQ
INSERT INTO ESTIA_COORDBANQ (COORDBANQ_ID, ENTITE_NOM, ENTITE_ID, CPAYSIBAN, CLEIBAN, CODEIBAN, CPAYSBIC, BIC8, BIC3, CBANQUE, GUICHET, COMPTE, CLE, LINTIT, MIGCOMPT, LACTIF)
SELECT COORDBANQ_ID, ENTITE_NOM, ENTITE_ID, CPAYSIBAN, CLEIBAN, CODEIBAN, CPAYSBIC, BIC8, BIC3, CBANQUE, GUICHET, COMPTE, CLE, LINTIT, MIGCOMPT, LACTIF
FROM ESTIA_SOURCE..COORDBANQ
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CRIT: TABLE DES DIFFERENTS SOUS-CRITERES LIBRES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CRIT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CRIT
INSERT INTO ESTIA_CRIT (NOFICH, CLCRIT, CCRIT, LCRIT, TRIG, LACTIF)
SELECT NOFICH, CLCRIT, CCRIT, LCRIT, TRIG, LACTIF
FROM ESTIA_SOURCE..CRIT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CRITDP: TABLE DES CRITERES DE DEPENSES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CRITDP', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CRITDP
INSERT INTO ESTIA_CRITDP (CCRITDP, LCRITDP, CRUB, MONTANT, POURC, GCRITDP, TRIG, TYPFAC, CNOMENM, ACTRLER, HONO, REVERSE, CRUBTVA, CHARCONV, TAUXRED, IMMO, CCHAPITRE, CLETTRF, CREGCPTE, CRUBC, REGREPART, REGRF, LIBIS, NCRITDP, ACOMPTE, STOCK, FACTDIR, BANTVA, COPRO, CCRITLOC, TYPEMDT, MIGCOMPT, PEVOL, LACTIF, HCRITDP, CDEPR)
SELECT CCRITDP, LCRITDP, CRUB, MONTANT, POURC, GCRITDP, TRIG, TYPFAC, CNOMENM, ACTRLER, HONO, REVERSE, CRUBTVA, CHARCONV, TAUXRED, IMMO, CCHAPITRE, CLETTRF##1, CREGCPTE, CRUBC, REGREPART, REGRF, LIBIS, NCRITDP, ACOMPTE, STOCK, FACTDIR, BANTVA, COPRO, CCRITLOC, TYPEMDT, MIGCOMPT, PEVOL, LACTIF, HCRITDP, CDEPR
FROM ESTIA_SOURCE..CRITDP
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--CRITLIB: TABLE DES CRITERES LIBRES ASSOCIES AUX LOCAUX ET COMPTES LOCATAIRES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('CRITLIB', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_CRITLIB
INSERT INTO ESTIA_CRITLIB (NOFICH, CLEFICH, CLCRIT, CCRIT, TRIG, DCRITLIB, BANAL, MIGCOMPT)
SELECT NOFICH, CLEFICH, CLCRIT, CCRIT, TRIG, DCRITLIB, BANAL, MIGCOMPT
FROM ESTIA_SOURCE..CRITLIB
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG



--DEMINT: TABLE DES DEMANDES D'INTERVENTION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('DEMINT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_DEMINT
INSERT INTO ESTIA_DEMINT (CORG, NODEM, DATEDEM, XORG, CNATREC, DATSOUFIN, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CNATPIEC, TELDOM, TELTRA, TRIG, IEMPLOY, ENCOURS, OEMPLOY, DATCLO, COMPL, CMOTCLO, OCC, CNATFIN, DNATFIN, CORIREC, CURGENCE, DATLIM, DATINF, ESCALIER, ETAGE, FACTEDIT, REGCPT, CLE, BAT, CTYPTIERS, CTIERS, HEURDEM, OCC2, CMANDAT, MIGCOMPT, CSOLLICIT)
SELECT CORG, NODEM, DATEDEM, XORG, CNATREC, DATSOUFIN, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CNATPIEC, TELDOM, TELTRA, TRIG, IEMPLOY, ENCOURS, OEMPLOY, DATCLO, COMPL, CMOTCLO, OCC, CNATFIN, DNATFIN, CORIREC, CURGENCE, DATLIM, DATINF, ESCALIER, ETAGE, FACTEDIT, REGCPT, CLE, BAT, CTYPTIERS, CTIERS, HEURDEM, OCC2, CMANDAT, MIGCOMPT, CSOLLICIT
FROM ESTIA_SOURCE..DEMINT--SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--DETSEC: TABLE DES DETAILS DE LA VENTILATION COMPTABLE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('DETSEC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_DETSEC
INSERT INTO ESTIA_DETSEC (CCATEG, CORG, CSECTANA, CSECTREG, CTIERS, CTYPCOM, CTYPTIERS, LIGNE, MONTANT, MTDEVISE, REF, SENS, TRIG)
SELECT CCATEG, CORG, CSECTANA, CSECTREG, CTIERS, CTYPCOM, CTYPTIERS, LIGNE, REPLACE(MONTANT, ',','.') AS MONTANT, REPLACE(MTDEVISE, ',','.') AS MTDEVISE, REF, SENS, TRIG
FROM ESTIA_SOURCE..DETSEC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG



--DPROCTX: TABLE DOMAINE CONTENTIEUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('DPROCTX', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_DPROCTX
INSERT INTO ESTIA_DPROCTX (CTYPROC, NOPROC, CORG, CCOMPTE, NOBAIL, TYPER, CTYPTIERS, CTIERS, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DATCREAT, CEMPLOY, REF, DATCLO, CMOTSCR, DATSUSP, SMOTSCR, TRIG, MIGCOMPT, DSUSPFIN, DARRETE, PERARRETE, NODOS, PRINCIPAL)
SELECT CTYPROC, NOPROC, CORG, CCOMPTE, NOBAIL, TYPER, CTYPTIERS, CTIERS, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DATCREAT, CEMPLOY, REF, DATCLO, CMOTSCR, DATSUSP, SMOTSCR, TRIG, MIGCOMPT, DSUSPFIN, DARRETE, PERARRETE, NODOS, PRINCIPAL
FROM ESTIA_SOURCE..DPROCTX
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--EMPLOY: TABLE DES EMPLOYES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('EMPLOY', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_EMPLOY
INSERT INTO ESTIA_EMPLOY (CEMPLOY, CQC, LEMPLOY, CRESP, CVEHIC, CPAYS, DATNAI, IDENT, RUE, LIEUDIT, CPOS, VILLE, AUTACT, TRIG, CSERVI, DOSS, TECH, TECHCO, DEM, EDL, MTBON, INTERV, EMET, CTX, PCTX, MAR, CTRE, APOF, TELPH, LISTSTOCK, CFONCTIO, OPERATION, CTYPTIERS, CTIERS, CDIVIS, CSDIVIS, UTIL, CLIEU, CACTIVITE, AUTORISE, SAUTORISE, CAUTORISE, INITIALES, INTERNET, ADRCOMP, GESTIONEDI, TECHEDI, MIGCOMPT, PRENOM, FAX, PORTABLE, EYTIERS, EYTYPTIERS)
SELECT CEMPLOY, CQC, LEMPLOY, CRESP, CVEHIC, CPAYS, DATNAI, IDENT, RUE, LIEUDIT, CPOS, VILLE, AUTACT, TRIG, CSERVI, DOSS, TECH, TECHCO, DEM, EDL, MTBON, INTERV, EMET, CTX, PCTX, MAR, CTRE, APOF, TELPH, LISTSTOCK, CFONCTIO, OPERATION, CTYPTIERS, CTIERS, CDIVIS, CSDIVIS, UTIL, CLIEU, CACTIVITE, AUTORISE, SAUTORISE, CAUTORISE, INITIALES, INTERNET, ADRCOMP, GESTIONEDI, TECHEDI, MIGCOMPT, PRENOM, FAX, PORTABLE, EYTIERS, EYTYPTIERS
FROM ESTIA_SOURCE..EMPLOY
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--FINDIV: TABLE DE début et fin de gestion des fournisseurs
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('FINDIV', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_FINDIV
INSERT INTO ESTIA_FINDIV (CTYPTIERS, CTIERS, FINGEST, CMOTGES, TRIG, DEBGEST, RTYPTIERS, RTIERS, MODETVA, CONTCA, BLCTFAC, LISTORG, MIGCOMPT, CPRIOR, PARTICULIER)
SELECT CTYPTIERS, CTIERS, FINGEST, CMOTGES, TRIG, 
ISNULL(CASE WHEN LEN(DEBGEST) = 8 THEN SUBSTRING(DEBGEST, 7, 2) WHEN LEN(DEBGEST) = 10 THEN SUBSTRING(DEBGEST, 7, 4) END  + SUBSTRING(DEBGEST, 4, 2) + LEFT(DEBGEST, 2), '') AS DEBGEST, 
--CASE WHEN LEN(DEBGEST) = 8 THEN convert(datetime, SUBSTRING(DEBGEST, 7, 2) + substring(DEBGEST, 4, 2) + substring(DEBGEST, 1, 2), 103)
--	 WHEN LEN(DEBGEST) = 10 THEN convert(datetime, substring(DEBGEST, 7, 4) + substring(DEBGEST, 4, 2) + substring(DEBGEST, 1, 2), 103) END AS DEBGEST,
RTYPTIERS, RTIERS, MODETVA, CONTCA, BLCTFAC, LISTORG, MIGCOMPT, CPRIOR, PARTICULIER
FROM ESTIA_SOURCE..FINDIV
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--GROUPE: TABLE DES GROUPES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('GROUPE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_GROUPE
INSERT INTO ESTIA_GROUPE (CORG, CAGENCE, CGROUPE, LGROUPE, RUE, LIEUDIT, CPOS, VILLE, CCOMM, CQUART, CSECTEUR, CCATHLM, CCATIMM, RCTIERS, DEBOP, FINOP, DEBLOC, DATREN, CFINANC, TREPART, DATCONV, CONTCONV, CSECTANA, DATDCONS, DATFCONS, DATACHAT, DATSERV, DATREHA, TEMPATRI, CREGIS, CENCAIS, LOYMAXI, COEFREL, COEFOBJ, CTYPTOUR, CBASSIN, LOYMORIG, RCTYPTIERS, GETIERS, CENVOI, COEFSURL, FINGEST, BLOCAGE, GESTDEPUIS, GESTION, GEOVAR, TVA, TAUXN, [TAUXN-1], FINTVA, TAXBUREAU, PREPOND, PRIXMARCHE, CZONE, COTIERS, GETYPTIERS, CRESP, TYPGEST, CANNEXE1, COTYPTIERS, TRIG, CANNEXE2, STECH, SGEST, SCOMPTA, DEBAN1, FINAN1, DEBAN2, FINAN2, NOTYPTIERS, NOTIERS, DATEVAL, DATAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DOTYPTIERS, DOTIERS, PRTYPTIERS, PRTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, DVENTE, DAUTO, CDEPART, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, CNIVRATT1, CNIVRATT2, CNIVRATT3, CNIVRATT4, CNIVRATT5, CNIVRATT6, CNIVRATT7, CNIVRATT8, DDCONS, DFCONS, DREHAB, CONVENT, TRANSOP, PROVHT, INTPEGAS, ADRCOMP, D1FUSION, D2FUSION, TYPSOL, MIGCOMPT, CFISCAL, TEMMAJ, DATMAJ, COMPOSITION, PERMISCONS, ADRESSE_ID, AGENCE_ID, ARCHIVE, CCATEGORIE, CIMPLANTAT, GROUPE_ID, NBBATIMENTS, NBIMMEUBLES, NBLOCAUX, NUMSEQUENCEDOSSIER, REFERENCE)
SELECT CORG, CAGENCE, CGROUPE, LGROUPE, RUE, LIEUDIT, CPOS, VILLE, CCOMM, CQUART, CSECTEUR, CCATHLM, CCATIMM, RCTIERS, DEBOP, FINOP, DEBLOC, DATREN, CFINANC, TREPART, DATCONV, CONTCONV, CSECTANA, DATDCONS, DATFCONS, 
DATACHAT, DATSERV, DATREHA, TEMPATRI, CREGIS, CENCAIS, LOYMAXI, COEFREL, COEFOBJ, CTYPTOUR, CBASSIN, LOYMORIG, RCTYPTIERS, GETIERS, CENVOI, COEFSURL, FINGEST, BLOCAGE, GESTDEPUIS, GESTION, GEOVAR, TVA, TAUXN, [TAUXN_1], FINTVA, TAXBUREAU, PREPOND, PRIXMARCHE, CZONE, COTIERS, GETYPTIERS, CRESP, TYPGEST, CANNEXE1, COTYPTIERS, TRIG, CANNEXE2, STECH, SGEST, SCOMPTA, DEBAN1, FINAN1, DEBAN2, FINAN2, NOTYPTIERS, NOTIERS, DATEVAL, DATAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DOTYPTIERS, DOTIERS, PRTYPTIERS, PRTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, 
DVENTE, DAUTO, CDEPART, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, CNIVRATT1, CNIVRATT2, CNIVRATT3, CNIVRATT4, CNIVRATT5, CNIVRATT6, CNIVRATT7, CNIVRATT8, 
ISNULL(CASE WHEN LEN(DDCONS) = 8 THEN SUBSTRING(DDCONS, 7, 2) WHEN LEN(DDCONS) = 10 THEN SUBSTRING(DDCONS, 7, 4) END  + SUBSTRING(DDCONS, 4, 2) + LEFT(DDCONS, 2), '') AS DDCONS, 
ISNULL(CASE WHEN LEN(DFCONS) = 8 THEN SUBSTRING(DFCONS, 7, 2) WHEN LEN(DFCONS) = 10 THEN SUBSTRING(DFCONS, 7, 4) END  + SUBSTRING(DFCONS, 4, 2) + LEFT(DFCONS, 2), '') AS DFCONS, 
DREHAB, CONVENT, TRANSOP, PROVHT, INTPEGAS, ADRCOMP, D1FUSION, D2FUSION, TYPSOL, MIGCOMPT, CFISCAL, TEMMAJ, DATMAJ, COMPOSITION, PERMISCONS, ADRESSE_ID, AGENCE_ID, ARCHIVE, CCATEGORIE, CIMPLANTAT, GROUPE_ID, NBBATIMENTS, NBIMMEUBLES, NBLOCAUX, NUMSEQUENCEDOSSIER, REFERENCE
FROM ESTIA_SOURCE..GROUPE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--GRPSEC: TABLE DES LIENS GROUPES/SECTIONS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('GRPSEC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_GRPSEC
INSERT INTO ESTIA_GRPSEC (CORG, CAGENCE, CGROUPE, CMODULE, CSECTANA, CSECTREG)
SELECT CORG, CAGENCE, CGROUPE, CMODULE, CSECTANA, CSECTREG
FROM ESTIA_SOURCE..GRPSEC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HAVENAN: HISTORIQUE DES AVENANTS AU BAIL
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HAVENAN', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HAVENAN
INSERT INTO ESTIA_HAVENAN (CORG, CCOMPTE, NOBAIL, NAVENAN, DDEB, COMMENT, TRIG, NOLOCAT, CMOTIF, DSIGNATU)
SELECT CORG, CCOMPTE, NOBAIL, NAVENAN, DDEB, COMMENT, TRIG, NOLOCAT, CMOTIF, DSIGNATU
FROM ESTIA_SOURCE..HAVENAN
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HDEPCS: TABLE DES HISTORIQUES DES DEPENSES CRITERE/SOUS-CRI
TRUNCATE TABLE ESTIA_HDEPCS
INSERT INTO ESTIA_HDEPCS (CORG ,CAGENCE ,CGROUPE ,CCRITDP ,CSCRITDP ,DEFFETREG ,REF ,MTHT ,MTTVA ,TEXTDEP ,MTRECUP ,MTTC ,TYPDEP ,TRIG ,MTBASE ,MTNREC ,MTTVADED ,CTVA ,PRORATA ,CSECTANA ,CSECTREG ,LIBELLE ,CCATEG ,DEVHT ,DEVTVA ,DEVRECUP ,DEVTTC ,DEVBASE ,DEVNREC ,DEVTVADED ,TEXTCOP ,DATEC ,NUMINV ,RECUPTX ,CNOMENM ,TVACOMPTA ,PROVHT ,NORD ,HTRECUP ,TTCRECUP ,TVARECUP ,ANAENC ,MTTVADEDREC ,EXTRAC ,CMANDAT ,CPRESTA ,QTE ,CEDIRGT ,CENSEMBLE ,RENOUV ,ADF)
SELECT CORG ,CAGENCE ,CGROUPE ,CCRITDP ,CSCRITDP ,
CASE WHEN LEN(DEFFETREG) = 8 AND ISDATE(SUBSTRING(DEFFETREG, 7, 2) + substring(DEFFETREG, 4, 2) + substring(DEFFETREG, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DEFFETREG, 7, 2) + substring(DEFFETREG, 4, 2) + substring(DEFFETREG, 1, 2), 103)
	 WHEN LEN(DEFFETREG) = 10 AND ISDATE(substring(DEFFETREG, 7, 4) + substring(DEFFETREG, 4, 2) + substring(DEFFETREG, 1, 2)) = 1 THEN convert(datetime, substring(DEFFETREG, 7, 4) + substring(DEFFETREG, 4, 2) + substring(DEFFETREG, 1, 2), 103) END AS DEFFETREG ,
REF ,REPLACE(MTHT, ',','.') AS MTHT ,REPLACE(MTTVA, ',','.') AS MTTVA ,TEXTDEP ,REPLACE(MTRECUP, ',','.') AS MTRECUP ,
REPLACE(MTTC, ',','.') AS MTTC ,TYPDEP ,TRIG ,REPLACE(MTBASE, ',','.') AS MTBASE ,REPLACE(MTNREC, ',','.') AS MTNREC ,REPLACE(MTTVADED, ',','.') AS MTTVADED ,
CTVA ,REPLACE(PRORATA, ',','.') AS PRORATA ,CSECTANA ,CSECTREG ,LIBELLE ,CCATEG ,REPLACE(DEVHT, ',','.') AS DEVHT ,REPLACE(DEVTVA, ',','.') AS DEVTVA ,REPLACE(DEVRECUP, ',','.') AS DEVRECUP ,REPLACE(DEVTTC, ',','.') AS DEVTTC ,REPLACE(DEVBASE, ',','.') AS DEVBASE ,
REPLACE(DEVNREC, ',','.') AS DEVNREC ,REPLACE(DEVTVADED, ',','.') AS DEVTVADED ,TEXTCOP ,
CASE WHEN LEN(DATEC) = 8 AND ISDATE(SUBSTRING(DATEC, 7, 2) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2)) = 1 THEN convert(datetime, SUBSTRING(DATEC, 7, 2) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2), 103)
	 WHEN LEN(DATEC) = 10 AND ISDATE(substring(DATEC, 7, 4) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2)) = 1 THEN convert(datetime, substring(DATEC, 7, 4) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2), 103) END AS DATEC ,
NUMINV ,REPLACE(RECUPTX, ',','.') AS RECUPTX ,CNOMENM ,TVACOMPTA ,PROVHT ,NORD ,REPLACE(HTRECUP, ',','.') AS HTRECUP ,REPLACE(TTCRECUP, ',','.') AS TTCRECUP ,REPLACE(TVARECUP, ',','.') AS TVARECUP ,
ANAENC ,REPLACE(MTTVADEDREC, ',','.') AS MTTVADEDREC ,EXTRAC ,CMANDAT ,CPRESTA ,REPLACE(QTE, ',','.') AS QTE ,CEDIRGT ,CENSEMBLE ,RENOUV ,ADF
FROM ESTIA_SOURCE..HDEPCS

--HLOYCA: TABLE D'HISTORIQUE DES CHIFFRES D'AFFAIRE table non utilisee par SWISS LIFE
--INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HLOYCA', 'N', GETDATE())
--SET @ID_LOG = @@IDENTITY
----TRUNCATE TABLE ESTIA_HLOYCA
--INSERT INTO ESTIA_HLOYCA (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DDEB, MTPROVI, MTFINAL, DMAJ, UTIL, TRIG, DREVIS, LRATTRAP)
--SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DDEB, MTPROVI, MTFINAL, DMAJ, UTIL, TRIG, DREVIS, LRATTRAP
--FROM OPENQUERY(ESTIA, 'SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DDEB, MTPROVI, MTFINAL, DMAJ, UTIL, TRIG, DREVIS, LRATTRAP FROM PUB.HLOYCA')
--SET @NB = @@ROWCOUNT
--UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HQFAC: TABLE DES DETAILS DES ECRITURES FACTUREES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HQFAC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HQFAC
INSERT INTO ESTIA_HQFAC (CORG ,CCOMPTE ,NOLOCAT ,CSTE ,TRUB ,CRUB ,REF ,MONTANT ,SENS ,ECHEANCE ,TRAIT ,CCPT ,DDEBCONS ,DFINCONS ,DATEC ,TRIG ,PERIODE ,CNATRUB ,CTYPDEC ,CJOURNAL ,EDITQUIT ,REFREJET ,CRATPBORD)
SELECT CORG ,CCOMPTE ,NOLOCAT ,CSTE ,TRUB ,CRUB ,REF ,REPLACE(MONTANT, ',','.') AS MONTANT ,SENS ,ECHEANCE ,TRAIT ,CCPT 
,CASE WHEN LEN(DDEBCONS) = 8 THEN case when isdate(SUBSTRING(DDEBCONS, 7, 2) + substring(DDEBCONS, 4, 2) + substring(DDEBCONS, 1, 2)) = 1 then convert(datetime, SUBSTRING(DDEBCONS, 7, 2) + substring(DDEBCONS, 4, 2) + substring(DDEBCONS, 1, 2), 103) else convert(datetime, '19000101', 103) end
	 WHEN LEN(DDEBCONS) = 10 THEN case when isdate(SUBSTRING(DDEBCONS, 7, 4) + substring(DDEBCONS, 4, 2) + substring(DDEBCONS, 1, 2)) = 1 then convert(datetime, substring(DDEBCONS, 7, 4) + substring(DDEBCONS, 4, 2) + substring(DDEBCONS, 1, 2), 103) else convert(datetime, '19000101', 103) end END AS DDDEBCONS
,CASE WHEN LEN(DFINCONS) = 8 THEN case when isdate(SUBSTRING(DFINCONS, 7, 2) + substring(DFINCONS, 4, 2) + substring(DFINCONS, 1, 2)) = 1 then convert(datetime, SUBSTRING(DFINCONS, 7, 2) + substring(DFINCONS, 4, 2) + substring(DFINCONS, 1, 2), 103) else convert(datetime, '19000101', 103) end
	 WHEN LEN(DFINCONS) = 10 THEN case when isdate(SUBSTRING(DFINCONS, 7, 4) + substring(DFINCONS, 4, 2) + substring(DFINCONS, 1, 2)) = 1 then convert(datetime, substring(DFINCONS, 7, 4) + substring(DFINCONS, 4, 2) + substring(DFINCONS, 1, 2), 103) else convert(datetime, '19000101', 103) end END AS DFINCONS
,CASE WHEN LEN(DATEC) = 8 THEN case when isdate(SUBSTRING(DATEC, 7, 2) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2)) = 1 then convert(datetime, SUBSTRING(DATEC, 7, 2) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2), 103) else convert(datetime, '19000101', 103) end
	 WHEN LEN(DATEC) = 10 THEN case when isdate(SUBSTRING(DATEC, 7, 4) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2)) = 1 then convert(datetime, substring(DATEC, 7, 4) + substring(DATEC, 4, 2) + substring(DATEC, 1, 2), 103) else convert(datetime, '19000101', 103) end END AS DATEC
,TRIG ,PERIODE ,CNATRUB ,CTYPDEC ,CJOURNAL ,EDITQUIT ,REFREJET ,CRATPBORD
FROM ESTIA_SOURCE..HQFAC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HQLOCAL: HISTORIQUE DES RUBRIQUES DE QUITTANCEMENT LIES AUX LOCAUX (VLM)
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HQLOCAL', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HQLOCAL
INSERT INTO ESTIA_HQLOCAL (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CRUB, DDEB, DFIN, NB, TRIG, CMETREV, MONTREV, MTCUMREA, MTCUMVAC, INDANC, LFACIAL, CCATHLM, MIGCOMPT, LOCAL_ID)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CRUB, 
ISNULL(SUBSTRING(DDEB, 7, 2) + SUBSTRING(DDEB, 4, 2) + LEFT(DDEB, 2), '') AS DDEB, 
ISNULL(CASE WHEN LEN(DFIN) = 8 THEN SUBSTRING(DFIN, 7, 2) WHEN LEN(DFIN) = 10 THEN SUBSTRING(DFIN, 7, 4) END  + SUBSTRING(DFIN, 4, 2) + LEFT(DFIN, 2), '') AS DFIN, 
REPLACE(NB, ',','.') AS NB, TRIG, CMETREV, MONTREV, MTCUMREA, MTCUMVAC, INDANC, LFACIAL, CCATHLM, MIGCOMPT, LOCAL_ID
FROM ESTIA_SOURCE..HQLOCAL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HQLOCAT: TABLE DES VARIABLES DE QUITTANCEMENT DES BAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HQLOCAT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HQLOCAT
INSERT INTO ESTIA_HQLOCAT (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CRUB, DDEB, DFIN, CSTE, NB, MONUNIT, ECHEANCE, TRAIT, LIBELLE, CMETREV, MONTREV, INDANC, DATENRGT, TRIG, CTYPDEC, CCOMREV, NOLIG, POURCIDR, PEREVISION, DREVISION, TRIMIND, ANCNB, ANCMONUNIT, TMR, TR, TAUXR, VALPOINT, ANCTRIMIND, MPOURC, LFACIAL, LREVIS, DREVIS, LDG, PROVHT, CCATHLM, LGESHONO, MIGCOMPT, ERUB)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CRUB, --DDEB, DFIN,
--ISNULL(CASE WHEN LEN(DDEB) = 8 THEN SUBSTRING(DDEB, 7, 2) WHEN LEN(DDEB) = 10 THEN SUBSTRING(DDEB, 7, 4) END  + SUBSTRING(DDEB, 4, 2) + LEFT(DDEB, 2), '') AS DDEB, 
CASE WHEN LEN(DDEB) = 8 THEN case when isdate(SUBSTRING(DDEB, 7, 2) + substring(DDEB, 4, 2) + substring(DDEB, 1, 2)) = 1 then convert(datetime, SUBSTRING(DDEB, 7, 2) + substring(DDEB, 4, 2) + substring(DDEB, 1, 2), 103) else convert(datetime, '19000101', 103) end
	 WHEN LEN(DDEB) = 10 THEN case when isdate(SUBSTRING(DDEB, 7, 4) + substring(DDEB, 4, 2) + substring(DDEB, 1, 2)) = 1 then convert(datetime, substring(DDEB, 7, 4) + substring(DDEB, 4, 2) + substring(DDEB, 1, 2), 103) else convert(datetime, '19000101', 103) end END AS DDEB,
CASE WHEN LEN(DFIN) = 8 THEN convert(datetime, SUBSTRING(DFIN, 7, 2) + substring(dfin, 4, 2) + substring(dfin, 1, 2), 103)
	 WHEN LEN(DFIN) = 10 THEN convert(datetime, substring(dfin, 7, 4) + substring(dfin, 4, 2) + substring(dfin, 1, 2), 103) END AS DFIN, 
CSTE, REPLACE(NB, ',','.') AS NB, REPLACE(MONUNIT, ',','.') AS MONUNIT, --ECHEANCE, 
ISNULL(CASE WHEN LEN(ECHEANCE) = 8 THEN SUBSTRING(ECHEANCE, 7, 2) WHEN LEN(ECHEANCE) = 10 THEN SUBSTRING(ECHEANCE, 7, 4) END  + SUBSTRING(ECHEANCE, 4, 2) + LEFT(ECHEANCE, 2), '') AS ECHEANCE, 
TRAIT, LIBELLE, CMETREV, REPLACE(MONTREV, ',','.') AS MONTREV, REPLACE(INDANC, ',','.') AS INDANC, DATENRGT, TRIG, CTYPDEC, CCOMREV, NOLIG, REPLACE(POURCIDR, ',','.') AS POURCIDR, PEREVISION, DREVISION, TRIMIND, REPLACE(ANCNB, ',','.') AS ANCNB, REPLACE(ANCMONUNIT, ',','.') AS ANCMONUNIT, REPLACE(TMR, ',','.') AS TMR, REPLACE(TR, ',','.') AS TR, REPLACE(TAUXR, ',','.') AS TAUXR, REPLACE(VALPOINT, ',','.') AS VALPOINT, ANCTRIMIND, REPLACE(MPOURC, ',','.') AS MPOURC, LFACIAL, LREVIS, DREVIS, LDG, PROVHT, CCATHLM, LGESHONO, MIGCOMPT, ERUB
FROM ESTIA_SOURCE..HQLOCAT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HQRBAIL: TABLE D'HISTORIQUE DE RENOUVELLEMENT DES BAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HQRBAIL', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HQRBAIL
INSERT INTO ESTIA_HQRBAIL (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DPRORENO, DRELANCE, DSIGNLOC, DRENOUV, DREEXAM, TRIG, CCOMPTE, NOBAIL, TEMOIN, DREPONSE)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, DPRORENO, DRELANCE, 
ISNULL(SUBSTRING(DSIGNLOC, 7, 2) + SUBSTRING(DSIGNLOC, 4, 2) + LEFT(DSIGNLOC, 2), '') AS DSIGNLOC, ISNULL(DRENOUV, '') AS DRENOUV
, DREEXAM, TRIG, CCOMPTE, NOBAIL, TEMOIN, DREPONSE
FROM ESTIA_SOURCE..HQRBAIL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--HREVI: TABLE D'HISTORIQUE DES REVISIONS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HREVI', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_HREVI
INSERT INTO ESTIA_HREVI (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CRUB, DDEB, DFIN, CSTE, NB, MONUNIT, ECHEANCE, TRAIT, LIBELLE, CMETREV, MONTREV, INDANC, DATENRGT, TRIG, CTYPDEC, CCOMREV, NOLIG, POURCIDR, PEREVISION, DREVISION, TRIMIND, ANCNB, ANCMONUNIT, TMR, TR, TAUXR, VALPOINT, ANCTRIMIND, MPOURC, LFACIAL, LREVIS, DREVIS, CNUMI, PRCPLAF, MIGCOMPT)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CRUB, DDEB, DFIN, CSTE, REPLACE(NB, ',','.') AS NB, MONUNIT, ECHEANCE, TRAIT, LIBELLE, CMETREV, MONTREV, REPLACE(INDANC, ',','.') AS INDANC, DATENRGT, TRIG, CTYPDEC, CCOMREV, NOLIG, POURCIDR, PEREVISION, DREVISION, TRIMIND, REPLACE(ANCNB, ',','.') AS ANCNB, ANCMONUNIT, TMR, TR, TAUXR, REPLACE(VALPOINT, ',','.') AS VALPOINT, ANCTRIMIND, MPOURC, LFACIAL, LREVIS, DREVIS, CNUMI, PRCPLAF, MIGCOMPT
FROM ESTIA_SOURCE..HREVI
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG



--HTRCA: TABLE DES TRANCHES DE CA table non utilisee par SWISS LIFE
--INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('HTRCA', 'N', GETDATE())
--SET @ID_LOG = @@IDENTITY
--TRUNCATE TABLE ESTIA_HTRCA
--INSERT INTO ESTIA_HTRCA (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, MTMINI, MTMAXI, PRCCA, TRIG, DDEB, DREVIS, ANCIND, NOUIND, CNUMI)
--SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, MTMINI, MTMAXI, PRCCA, TRIG, DDEB, DREVIS, ANCIND, NOUIND, CNUMI
--FROM OPENQUERY(ESTIA, 'SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, MTMINI, MTMAXI, PRCCA, TRIG, DDEB, DREVIS, ANCIND, NOUIND, CNUMI FROM PUB.HTRCA')
--SET @NB = @@ROWCOUNT
--UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--IMMEUB: TABLE DES IMMEUBLES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('IMMEUB', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_IMMEUB
INSERT INTO ESTIA_IMMEUB (CORG, CAGENCE, CGROUPE, CIMMEUB, LIMMEUB, RUE, LIEUDIT, CPOS, VILLE, CCOMM, CQUART, CSECTEUR, CBASSIN, CFACT, CCATHLM, CCATIMM, RCTIERS, DEBLOC, DATREHA, CFINANC, GETIERS, CENCAIS, DATCONV, CONTCONV, DATDCONS, DATFCONS, DATACHAT, DATSERV, TEMPATRI, SSOL, LONG, LARG, HAUT, VOLUME, NBNIV, COEFOBJ, COEFREL, CREGIS, CZONE, LOYMAXI, RIMMEUB, CTYPTOUR, INTIERS, COEFSURL, FINGEST, GELLOC, GEOVAR, PRIXMARCHE, COTIERS, RCTYPTIERS, GETYPTIERS, COTYPTIERS, INTYPTIERS, TRIG, DOTIERS, DOTYPTIERS, DTRANSF, ANCSOC, ANCAG, MONTANT, DEXPERT, PRTYPTIERS, PRTIERS, PREPOND, SHORSOEUVRE, DVENTE, DAUTO, MTACHAT, MTVEN, VOTYPTIERS, VOTIERS, ACTYPTIERS, ACTIERS, PRXVENT, PRXPLAN, DATEVAL, NOTYPTIERS, NOTIERS, ODTIERS, ODTYPTIERS, TRTYPTIERS, TRTIERS, DATAUTO, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, LBAT, GESTDEPUIS, CONVENT, CARROND, ADRCOMP, DDEBTRAV, DFINTRAV, SURFINV, SURFPRECOM, COMMENT, MIGCOMPT, TEMMAJ, DATMAJ, PREMANN, SOUMTFPB, CDEPART, ADRESSE_ID, ARCHIVE, BATIMENT_ID, CETATBATI, CETATIMMEUB, CFONCTION, CINCENDIE, COMBLE, CSECURITE, CSFONCTION, DFEXONERATION, DPREVACHAT, DPREVENT, DRENOVATION, GROUPE_ID, HAUTEUR, IMMEUB_ID, LARGEUR, LONGUEUR, NBASCENSEURS, NBCABLE, NBCAVES, NBENTREES, NBENTREPOTS, NBEXTINCTEURS, NBIMMEUB, NBLOCAUX, NBNIVEAUX, NBSOUSOLS, NBVIDEORDURE, NBVMC, NOMLONG, REFERENCE, SANITAIRE, SHOB, SURFCOMMERCIALE, SURFDEPOT, SURFENTREPOT, SURFGRAPHIQUE, SREELLE, SURFLOCAUX, SURFRESERVE, SURFSUCCURSALE, SURFTERRAIN, TCOMMUN, TLOCATION, TOCCUPATION, ANCSOC_ID, ANCAG_ID, ACTIERS_ID, DOTIERS_ID, ODTIERS_ID, VOTIERS_ID, NOTIERS_ID, PRTIERS_ID, TRTIERS_ID, DACHAT)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, LIMMEUB, RUE, LIEUDIT, CPOS, VILLE, CCOMM, CQUART, CSECTEUR, CBASSIN, CFACT, CCATHLM, CCATIMM, RCTIERS, DEBLOC, DATREHA, CFINANC, GETIERS, CENCAIS, DATCONV, CONTCONV, DATDCONS, DATFCONS, DATACHAT, DATSERV, TEMPATRI, SSOL, LONG_, LARG, HAUT, VOLUME, NBNIV, COEFOBJ, COEFREL, CREGIS, CZONE, LOYMAXI, RIMMEUB, CTYPTOUR, INTIERS, COEFSURL, FINGEST, GELLOC, GEOVAR, PRIXMARCHE, COTIERS, RCTYPTIERS, GETYPTIERS, COTYPTIERS, INTYPTIERS, TRIG, DOTIERS, DOTYPTIERS, DTRANSF, ANCSOC, ANCAG, REPLACE(MONTANT, ',','.') AS MONTANT, DEXPERT, PRTYPTIERS, PRTIERS, PREPOND, REPLACE(SHORSOEUVRE, ',','.') AS SHORSOEUVRE, DVENTE, DAUTO, REPLACE(MTACHAT, ',','.') AS MTACHAT, REPLACE(MTVEN, ',','.') AS MTVEN, VOTYPTIERS, VOTIERS, ACTYPTIERS, ACTIERS, REPLACE(PRXVENT, ',','.') AS PRXVENT, REPLACE(PRXPLAN, ',','.') AS PRXPLAN, DATEVAL, NOTYPTIERS, NOTIERS, ODTIERS, ODTYPTIERS, TRTYPTIERS, TRTIERS, DATAUTO, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, LBAT, GESTDEPUIS, CONVENT, CARROND, ADRCOMP, DDEBTRAV, DFINTRAV, REPLACE(SURFINV, ',','.') AS SURFINV, REPLACE(SURFPRECOM, ',','.') AS SURFPRECOM, COMMENT_, MIGCOMPT, TEMMAJ, DATMAJ, PREMANN, SOUMTFPB, CDEPART, ADRESSE_ID, ARCHIVE, BATIMENT_ID, CETATBATI, CETATIMMEUB, CFONCTION, CINCENDIE, COMBLE, CSECURITE, CSFONCTION, DFEXONERATION, DPREVACHAT, DPREVENT, DRENOVATION, GROUPE_ID, REPLACE(HAUTEUR, ',','.') AS HAUTEUR, IMMEUB_ID, REPLACE(LARGEUR, ',','.') AS LARGEUR, REPLACE(LONGUEUR, ',','.') AS LONGUEUR, NBASCENSEURS, NBCABLE, NBCAVES, NBENTREES, NBENTREPOTS, NBEXTINCTEURS, NBIMMEUB, NBLOCAUX, NBNIVEAUX, NBSOUSOLS, NBVIDEORDURE, NBVMC, NOMLONG, REFERENCE, SANITAIRE, REPLACE(SHOB, ',','.') AS SHOB, REPLACE(SURFCOMMERCIALE, ',','.') AS SURFCOMMERCIALE, REPLACE(SURFDEPOT, ',','.') AS SURFDEPOT, REPLACE(SURFENTREPOT, ',','.') AS SURFENTREPOT, REPLACE(SURFGRAPHIQUE, ',','.') AS SURFGRAPHIQUE, REPLACE(SREELLE, ',','.') AS SREELLE, REPLACE(SURFLOCAUX, ',','.') AS SURFLOCAUX, REPLACE(SURFRESERVE, ',','.') AS SURFRESERVE, REPLACE(SURFSUCCURSALE, ',','.') AS SURFSUCCURSALE, REPLACE(SURFTERRAIN, ',','.') AS SURFTERRAIN, TCOMMUN, TLOCATION, TOCCUPATION, ANCSOC_ID, ANCAG_ID, ACTIERS_ID, DOTIERS_ID, ODTIERS_ID, VOTIERS_ID, NOTIERS_ID, PRTIERS_ID, TRTIERS_ID, DACHAT
FROM ESTIA_SOURCE..IMMEUB
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--INDICE: TABLE DE VALEURS DES INDICES DE REVISION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('INDICE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_INDICE
INSERT INTO ESTIA_INDICE (CNUMI, ANNEE, MOIS, VAL, DEFPRO, TRIG, LACTIF)
SELECT CNUMI, ANNEE, MOIS, REPLACE(VAL,',','.') AS VAL, DEFPRO, TRIG, LACTIF
FROM ESTIA_SOURCE..INDICE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--ESTIA_INTBT: TABLE DES BONS DE TRAVAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('INTBT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_INTBT
INSERT INTO ESTIA_INTBT (CORG, NODEM, NOINTBT, CSTE1, CSTE2, CEMPLOY, CCORETA, IEMPLOY, CTYPTIERS, CTIERS, DATCREA, DATREND, HHREND, MNREND, TEMCLO, DATCLO, CMOTCLO, DATFINT, DATDINT, TERMINE, DATFINTRAV, CNATTRAV, DEJEDIT, DATREL1, DATREL2, DLEDIT, LAEDIT, QUITUS, TRIG, CNATPRES, TEMLIG, DLIMFAC, DATDEBTRAV, DATRELFAC1, DATRELFAC2, TEMBUD, DATPREMFAC, NORD, DATFACREG, CONGE, DATREP, PENALITE, PEGAS, RABAIS, DATRET, REFINTERF, EDITFAC, PRORATA, GESTIONHT, VALIDE, DETAT, CTVA, TEMINT, DATINT, DATEXP, CNOMENM, MODTVA, CMANDAT, CCRITDP, CSCRITDP, TXHAB, AGEIMM, ATTESTVA, REFORD, NUMINV, CENSEMBLE, DRELDEVP1, DRELDEVP2, DRELDEVP3, DRELDEVE1, DRELDEVE2, DRELDEVE3, MIGCOMPT, CNATHON, NATCTVA, NATMTHT, NATMTTC, DATEMAIL, ASSDO, CAGENCE, CGROUPE, CBATIMENT, CIMMEUB, CLOCAL, CPIECE, OCC, NOEDL, LIBELLE, DATDEMANDE, DATSYSTEME, DATVALIDD, LIBREND, BATREND, ESCREND, ETAGEREND, CCAUSEBT, MONOPAT, DELAI, DATSOUFIN, CURGENCE, CSOLLICIT, CAPTYPTIERS, CAPTIERS, DATEDIT, PREENREG, FACTURE, INVALIDE, EDITFALOC, ETAT, LASM, DCOMPTA, HTENGAGE, TVAENGAGE, HTREALISE, TVAREALISE, CONVENT, COMPTAREGIE, TYPENGAG, CCSTE, CCTYPTIERS, CCTIERS, NVVALIDE, ACTEVT_ID, TYPOCC, TYPADB)
SELECT CORG, NODEM, NOINTBT, CSTE1, CSTE2, CEMPLOY, CCORETA, IEMPLOY, CTYPTIERS, CTIERS, DATCREA, DATREND, HHREND, MNREND, TEMCLO, DATCLO, CMOTCLO, DATFINT, 
CASE WHEN LEN(DATDINT) = 8 THEN case when isdate(SUBSTRING(DATDINT, 7, 2) + substring(DATDINT, 4, 2) + substring(DATDINT, 1, 2)) = 1 then convert(datetime, SUBSTRING(DATDINT, 7, 2) + substring(DATDINT, 4, 2) + substring(DATDINT, 1, 2), 103) else convert(datetime, '19000101', 103) end
	 WHEN LEN(DATDINT) = 10 THEN case when isdate(SUBSTRING(DATDINT, 7, 4) + substring(DATDINT, 4, 2) + substring(DATDINT, 1, 2)) = 1 then convert(datetime, substring(DATDINT, 7, 4) + substring(DATDINT, 4, 2) + substring(DATDINT, 1, 2), 103) else convert(datetime, '19000101', 103) end END AS DATDINT, 
TERMINE, DATFINTRAV, CNATTRAV, DEJEDIT, DATREL1, DATREL2, DLEDIT, LAEDIT, QUITUS, TRIG, CNATPRES, TEMLIG, DLIMFAC, DATDEBTRAV, DATRELFAC1, DATRELFAC2, TEMBUD, DATPREMFAC, NORD, DATFACREG, CONGE, DATREP, PENALITE, PEGAS, RABAIS, DATRET, REFINTERF, EDITFAC, PRORATA, GESTIONHT, VALIDE, DETAT, CTVA, TEMINT, DATINT, DATEXP, CNOMENM, MODTVA, CMANDAT, CCRITDP, CSCRITDP, TXHAB, AGEIMM, ATTESTVA, REFORD, NUMINV, CENSEMBLE, DRELDEVP1, DRELDEVP2, DRELDEVP3, DRELDEVE1, DRELDEVE2, DRELDEVE3, MIGCOMPT, CNATHON, NATCTVA, NATMTHT, NATMTTC, DATEMAIL, ASSDO, CAGENCE, CGROUPE, CBATIMENT, CIMMEUB, CLOCAL, CPIECE, OCC, NOEDL, LIBELLE, DATDEMANDE, DATSYSTEME, DATVALIDD, LIBREND, BATREND, ESCREND, ETAGEREND, CCAUSEBT, MONOPAT, DELAI, DATSOUFIN, CURGENCE, CSOLLICIT, CAPTYPTIERS, CAPTIERS, DATEDIT, PREENREG, FACTURE, INVALIDE, EDITFALOC, ETAT, LASM, DCOMPTA, HTENGAGE, TVAENGAGE, HTREALISE, TVAREALISE, CONVENT, COMPTAREGIE, TYPENGAG, CCSTE, CCTYPTIERS, CCTIERS, NVVALIDE, ACTEVT_ID, TYPOCC, TYPADB
FROM ESTIA_SOURCE..INTBT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LCAUTION: TABLE DES CAUTIONS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LCAUTION', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LCAUTION
INSERT INTO ESTIA_LCAUTION (CTYPTIERS, CTIERS, CORG, CCOMPTE, DORG, NODEM, MONTANT, NOBAIL, DDVAL, DFVAL, DENVOI, TRIG, EMTYPTIERS, EMTIERS, CPARENTE, LIEUNAI, DATNAI, MTREV, CMOTIF, DMOTIF, LREVIS, DREVIS, LCOURR1, LCOURR2, BANAL1, BANAL2, BANAL3, BANAL4, NBJCAUT, LCLOCAUT, TRIMIND, ANCTRIMIND, CNUMI, INDANC, INDNOUV, DVALREV, MIGCOMPT, LPTYPTIE, LPCTIERS, REFEXTERNE, LCAUTION_ID)
SELECT CTYPTIERS, CTIERS, CORG, CCOMPTE, DORG, NODEM,REPLACE(MONTANT, ',','.') AS  MONTANT, NOBAIL, 
ISNULL(RIGHT(DDVAL, 2) + SUBSTRING(DDVAL, 4, 2) + LEFT(DDVAL, 2), '') AS DDVAL, 
--ISNULL(CASE WHEN LEN(DFVAL) = 8 THEN SUBSTRING(DFVAL, 7, 2) WHEN LEN(DFVAL) = 10 THEN SUBSTRING(DFVAL, 9, 2) END  + SUBSTRING(DFVAL, 4, 2) + LEFT(DFVAL, 2), '') AS DFVAL, 
CASE WHEN LEN(DFVAL) = 8 THEN convert(datetime, SUBSTRING(DFVAL, 7, 2) + substring(DFVAL, 4, 2) + substring(DFVAL, 1, 2), 103)
	 WHEN LEN(DFVAL) = 10 THEN convert(datetime, substring(DFVAL, 7, 4) + substring(DFVAL, 4, 2) + substring(DFVAL, 1, 2), 103) END AS DFVAL,
DENVOI, TRIG, EMTYPTIERS, EMTIERS, CPARENTE, LIEUNAI, DATNAI, REPLACE(MTREV, ',','.') AS MTREV, CMOTIF, DMOTIF, LREVIS, DREVIS, LCOURR1, LCOURR2, BANAL1, BANAL2, REPLACE(BANAL3, ',','.') AS BANAL3, BANAL4, NBJCAUT, LCLOCAUT, TRIMIND, ANCTRIMIND, CNUMI, REPLACE(INDANC, ',','.') AS INDANC, REPLACE(INDNOUV, ',','.') AS INDNOUV, DVALREV, MIGCOMPT, LPTYPTIE, LPCTIERS, REFEXTERNE, LCAUTION_ID
FROM ESTIA_SOURCE..LCAUTION
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


TRUNCATE TABLE ESTIA_LIENBN
INSERT INTO ESTIA_LIENBN (BANAL, CORG, CTIERS, DEFFET, MTLIAV,  MTTC, [0BON], REF, TRIG, TYPBON, TYPFAC)
SELECT BANAL, CORG, CTIERS, DEFFET, REPLACE(MTLIAV, ',','.') AS MTLIAV, REPLACE(MTTC, ',','.') AS MTTC, 0BON, REF, TRIG, TYPBON, TYPFAC
FROM ESTIA_SOURCE..LIENBN
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LIENLOC: TABLE DES LIENS ENTRE LES LOCAUX ET LES COMPTES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LIENLOC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LIENLOC
INSERT INTO ESTIA_LIENLOC (CTYPTIERS, CTIERS, CORG, CCOMPTE, TITULAIRE, DATSOR, TRIG, DATENT, MIGCOMPT, DATTACH, CMOTIFATT, DDETACH, CMOTIFDET, SOLIDDEB, SOLIDFIN, CHARGPLA, CHARGAPL, VISITE, OCCUPANT, CSITUFA, DATMAR, LIEUMAR, DATVIMA, DATVEU, DATDIV, DATDECES, CONFIDEN, CPARENTE, CTYPAREN, CTPARENT, CENFANAITR, DENFANAITR, CODEAGREM, NBANAITRE, ALTERNE, MULTIEMP, RK)
SELECT CTYPTIERS, CTIERS, CORG, CCOMPTE, TITULAIRE, DATSOR, TRIG, 
ISNULL(RIGHT(DATENT, 2) + SUBSTRING(DATENT, 4, 2) + LEFT(DATENT, 2), '') AS DATENT, MIGCOMPT, DATTACH, CMOTIFATT, DDETACH, CMOTIFDET, SOLIDDEB, SOLIDFIN, CHARGPLA, CHARGAPL, VISITE, OCCUPANT, CSITUFA, DATMAR, LIEUMAR, DATVIMA, DATVEU, DATDIV, DATDECES, CONFIDEN, CPARENTE, CTYPAREN, CTPARENT, CENFANAITR, DENFANAITR, CODEAGREM, NBANAITRE, ALTERNE, MULTIEMP,
       RANK() OVER (PARTITION BY CORG, CCOMPTE
                    ORDER BY CORG, CCOMPTE, ISNULL(TITULAIRE,0) DESC, CTYPTIERS, CTIERS,
                             ISNULL(DATENT, '1900/01/01'), ISNULL(DATENT, '2999/01/01') DESC) AS RK
FROM ESTIA_SOURCE..LIENLOC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LIENMO: TABLE DES LIENS MARCHE OPERATION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LIENMO', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LIENMO
INSERT INTO ESTIA_LIENMO (BANMAR, BANOPE, CORG, CSTE, POIDS, TRIG)
SELECT BANMAR, BANOPE, CORG, CSTE, POIDS, TRIG
FROM ESTIA_SOURCE..LIENMO
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LIENV: TABLE DES LIENS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LIENV', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LIENV
INSERT INTO ESTIA_LIENV (CLEDE, CLEOR, CSTE, MIGCOMPT, TRIG)
SELECT CLEDE, CLEOR, CSTE, MIGCOMPT, TRIG
FROM ESTIA_SOURCE..LIENV
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LOCAL: TABLE DES LOCAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LOCAL', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LOCAL
INSERT INTO ESTIA_LOCAL (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, RUE, LIEUDIT, CPOS, VILLE, CCOMM, BAT, ESC, ETAGE, PORTE, CAVE, PARK, GARAGE, CTYPLOG, CCATHLM, CCATIMM, CNATLOG, GETIERS, DFINML, RCTIERS, TERME, PERIOD, DEPASS, AVIAPEL, CBAIL, CACCESS, SHAB, SCORR, SGAR, CINDCOL, RCTYPTIERS, GETYPTIERS, COTYPTIERS, COEFPOND, CTEMLOC, LOGCOM, CVIDORD, AFACT, DEBLOC, LINDCOL, REFIMP, COTIERS, LOGSOC, CDEPART, CTYPALL, TEMPROP, TRAVCOND, TRAVAUX, CREGIS, CENCAIS, CMOTVAC, SCHAU, JARDIN, OSHAB, OSCORR, DDEBPAL, TEMPAL, DDEBHAL, TEMHAL, DEBPASS, CFINANC, CHANDI, CLIMAT, FINGEST, SDISPO, GEOVAR, CUSALOC, CFACT, DFINPASS, TRIG, NBHABIT, DATCONV, CONTCONV, COEFREL, COEFOBJ, COEFSURL, CQUART, CSECTEUR, CZONE, CBASSIN, DATACHAT, ISTYPTIERS, ISTIERS, IEMPLOY, REFDEROG, DDEROG, CMOTDERO, NOTYPTIERS, NOTIERS, DATEVAL, DATAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DECOMPTE, GESUTIL, AEMPLOY, TEMPLOY, EEMPLOY, HUTYPTIERS, HUTIERS, AVTYPTIERS, AVTIERS, ELTYPTIERS, ELTIERS, GATYPTIERS, GATIERS, EATYPTIERS, EATIERS, TETYPTIERS, TETIERS, POTYPTIERS, POTIERS, CMTYPTIERS, CMTIERS, ORTYPTIERS, ORTIERS, CPTYPTIERS, CPTIERS, GRTYPTIERS, GRTIERS, DOTYPTIERS, DOTIERS, MXTYPTIERS, MXTIERS, MONLOY, MONCHARG, TSLS, DGEL, CCONVSU, CREGENC, PRTYPTIERS, PRTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, DVENTE, DAUTO, PEGAS, TRIGD, TXEFF, DRELOC, TPTYPTIERS, TPTIERS, CARROND, ADRCOMP, SRU, IDPRGES, IZURB, DDCONS, DFINCONS, DREHAB, CTYPPROP, DPREVENT, CTYPDEDRF, TEMTRANS, DATDEBTR, CLOCCONT, MIGCOMPT, ASSUR, PRCASS, TEMMAJ, DATMAJ, DDESIUNIQ, TDESIUNIQ, CMOTSORTIE, DATESORTIE, DPREVACHAT, IMMEUB_ID, LOCAL_ID, ARCHIVE, XEMPLOY, NOTEDU)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, RUE, LIEUDIT, CPOS, VILLE, CCOMM, BAT, ESC, ETAGE, PORTE, CAVE, PARK, GARAGE, CTYPLOG, CCATHLM, CCATIMM, CNATLOG, GETIERS, DFINML, RCTIERS, TERME, PERIOD, DEPASS, AVIAPEL, CBAIL, CACCESS, SHAB, SCORR, SGAR, CINDCOL, RCTYPTIERS, GETYPTIERS, COTYPTIERS, COEFPOND, CTEMLOC, LOGCOM, CVIDORD, AFACT, DEBLOC, LINDCOL, REFIMP, COTIERS, LOGSOC, CDEPART, CTYPALL, TEMPROP, TRAVCOND, TRAVAUX, CREGIS, CENCAIS, CMOTVAC, SCHAU, JARDIN, OSHAB, OSCORR, DDEBPAL, TEMPAL, DDEBHAL, TEMHAL, DEBPASS, CFINANC, CHANDI, CLIMAT, FINGEST, SDISPO, GEOVAR, CUSALOC, CFACT, DFINPASS, TRIG, NBHABIT, DATCONV, CONTCONV, COEFREL, COEFOBJ, COEFSURL, CQUART, CSECTEUR, CZONE, CBASSIN, DATACHAT, ISTYPTIERS, ISTIERS, IEMPLOY, REFDEROG, DDEROG, CMOTDERO, NOTYPTIERS, NOTIERS, DATEVAL, DATAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DECOMPTE, GESUTIL, AEMPLOY, TEMPLOY, EEMPLOY, HUTYPTIERS, HUTIERS, AVTYPTIERS, AVTIERS, ELTYPTIERS, ELTIERS, GATYPTIERS, GATIERS, EATYPTIERS, EATIERS, TETYPTIERS, TETIERS, POTYPTIERS, POTIERS, CMTYPTIERS, CMTIERS, ORTYPTIERS, ORTIERS, CPTYPTIERS, CPTIERS, GRTYPTIERS, GRTIERS, DOTYPTIERS, DOTIERS, MXTYPTIERS, MXTIERS, MONLOY, MONCHARG, TSLS, DGEL, CCONVSU, CREGENC, PRTYPTIERS, PRTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, DVENTE, DAUTO, PEGAS, TRIGD, TXEFF, DRELOC, TPTYPTIERS, TPTIERS, CARROND, ADRCOMP, SRU, IDPRGES, IZURB, 
--ISNULL(CASE WHEN LEN(DDCONS) = 8 THEN SUBSTRING(DDCONS, 7, 2) WHEN LEN(DDCONS) = 10 THEN SUBSTRING(DDCONS, 9, 2) END  + SUBSTRING(DDCONS, 4, 2) + LEFT(DDCONS, 2), '') AS DDCONS, 
CASE WHEN LEN(DDCONS) = 8 THEN convert(datetime, SUBSTRING(DDCONS, 7, 2) + substring(DDCONS, 4, 2) + substring(DDCONS, 1, 2), 103)
	 WHEN LEN(DDCONS) = 10 THEN convert(datetime, substring(DDCONS, 7, 4) + substring(DDCONS, 4, 2) + substring(DDCONS, 1, 2), 103) END AS DDCONS,
DFINCONS, DREHAB, CTYPPROP, DPREVENT, CTYPDEDRF, TEMTRANS, DATDEBTR, CLOCCONT, MIGCOMPT, ASSUR, PRCASS, TEMMAJ, DATMAJ, DDESIUNIQ, TDESIUNIQ, CMOTSORTIE, DATESORTIE, DPREVACHAT, IMMEUB_ID, LOCAL_ID, ARCHIVE, XEMPLOY, NOTEDU
FROM ESTIA_SOURCE..LOCAL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LOCASSUR: TABLE DES CONTRATS D'ASSURANCE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LOCASSUR', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LOCASSUR
INSERT INTO ESTIA_LOCASSUR (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CTYPASS, DATEFF, DATRESIL, NUMCONT, DECHEANCE, AGTYPTIERS, AGTIERS, TRIG, CITYPTIERS, CITIERS, MTMINIGAR, MIGCOMPT, MTASSUR, LOCASSUR_ID)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CTYPASS, DATEFF, DATRESIL, NUMCONT, DECHEANCE, AGTYPTIERS, AGTIERS, TRIG, CITYPTIERS, CITIERS, REPLACE(MTMINIGAR, ',','.') AS MTMINIGAR, MIGCOMPT, REPLACE(MTASSUR, ',','.') AS MTASSUR, LOCASSUR_ID
FROM ESTIA_SOURCE..LOCASSUR
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--LOCATION: TABLE DES BAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('LOCATION', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_LOCATION
INSERT INTO ESTIA_LOCATION (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CCOMPTE, NOLOCAT, CONTLOC, DATENTQUIT, DATENTREGU, DENTETAT, HEURETAT, MINETAT, CEMPLOY, DATSORQUIT, DATSOREGU, TERME, DATSORPREV, DATSORETAT, HEURETATPS, MINETATPS, PEMPLOY, DSORETAT, HEURETATS, MINETATS, SEMPLOY, CTYPLOC, PERIOD, CBAIL, COEFPOND, COEFREL, RPTIERS, RETIERS, RPTYPTIERS, CTYPECRI, DECOMPTE, RETYPTIERS, DURBAIL, DURPREAV, DGARAN, DATENTBAIL, DATSORCONT, CMOTDDE, CDESTI, TRIMIND, NOBAIL, DEBPER, SHAB, SCORR, SCHAU, NOCONT, DREVISION, PEREVISION, ENTPRES, EDITAR, EDITDEC, TRIG, DENRGSORT, DEMISAVIS, DIMPQUITT, CACCESS, MOIPER, DATEFFET, DATFIN, TAXADD, TAUXRECUP, CQUABAIL, DGREV, SUTILE, SCUTILE, INDEMOCC, COEF, SREELLE, SIMPOS, COPRO, EDITBAIL, POURCIDR, MTPREV, REFINTERF, PRETMT, PRETDEP, PRETOBJ, PRETDUR, MUTANT, DGDU, DGENC, ALERTE, MATYPTIERS, MATIERS, DATTACH, DDETACH, DFERME, MTMINICA, MTMAXICA, PRCCA, DGFACIAL, INDCONNU, LBAREMCA, PRISQUE, PFERME, PREAGES, CNUMI, DERTERM, INDREF, NAVENAN, DREVIS, DECHEANCE, LTVA, LDIV, INDPREC, NBDG, LTRIENNAL, SIGETATS, LREVCAUT, LCLOCAUT, NBJCAUT, CMOTIF, NBPRCAU, CFTYPTIERS, RELANCE, TYPEDI, COMPENS, COCORG, COMANDAT, CODDEB, CODFIN, CFTIERS, COCTIERS, CFCONVOC, DFINBAIL, MACONVOC, NBJBAIL, RPCONVOC, LOCIDR, CMANDAT, PRCPLAF, PRCHONO, LDGTVA, CFISCAL, MIGCOMPT, CMOTIFNP, CMOTREP, TEMMAJ, DATMAJ, TEDCONG, DETDATE, LASSUR, LVIR, TYPTAUX, TAUXINT, CMOTIFDA, DEDITBAI, DELAIPAIEMENT, CMODPAI, DBASSIN, DSECTEUR, DCOMM, DPAYS, DDEPART, CENVOIAVIS, DEDITFACINOC, CTYPQUI, REVISNEG, EDELSOR, EDLENT, TAUXPLURI, DDEBPLAFPLURI, DFINPLAFPLURI, INDEXREFPLURI
)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, OCC, CCOMPTE, NOLOCAT, CONTLOC, DATENTQUIT, 
CASE WHEN LEN(DATENTREGU) = 8 THEN convert(datetime, SUBSTRING(DATENTREGU, 7, 2) + substring(DATENTREGU, 4, 2) + substring(DATENTREGU, 1, 2), 103)
	 WHEN LEN(DATENTREGU) = 10 THEN convert(datetime, substring(DATENTREGU, 7, 4) + substring(DATENTREGU, 4, 2) + substring(DATENTREGU, 1, 2), 103) END AS DATENTREGU, 
DENTETAT, HEURETAT, MINETAT, CEMPLOY, DATSORQUIT, DATSOREGU, 
TERME, DATSORPREV, DATSORETAT, HEURETATPS, MINETATPS, PEMPLOY, DSORETAT, HEURETATS, MINETATS, SEMPLOY, CTYPLOC, PERIOD, CBAIL, REPLACE(COEFPOND, ',','.') AS COEFPOND, 
REPLACE(COEFREL, ',','.') AS COEFREL, RPTIERS, RETIERS, RPTYPTIERS, CTYPECRI, DECOMPTE, RETYPTIERS, DURBAIL, DURPREAV, REPLACE(DGARAN, ',','.') AS DGARAN, 
--ISNULL(CASE WHEN LEN(DATENTBAIL) = 8 THEN SUBSTRING(DATENTBAIL, 7, 2) WHEN LEN(DATENTBAIL) = 10 THEN SUBSTRING(DATENTBAIL, 9, 2) END  + SUBSTRING(DATENTBAIL, 4, 2) + LEFT(DATENTBAIL, 2), '') AS DATENTBAIL, 
CASE WHEN LEN(DATENTBAIL) = 8 THEN convert(datetime, SUBSTRING(DATENTBAIL, 7, 2) + substring(DATENTBAIL, 4, 2) + substring(DATENTBAIL, 1, 2), 103)
	 WHEN LEN(DATENTBAIL) = 10 THEN convert(datetime, substring(DATENTBAIL, 7, 4) + substring(DATENTBAIL, 4, 2) + substring(DATENTBAIL, 1, 2), 103) END AS DREVIS,
DATSORCONT, CMOTDDE, CDESTI, TRIMIND, NOBAIL, DEBPER, REPLACE(SHAB, ',','.') AS SHAB, REPLACE(SCORR, ',','.') AS SCORR, REPLACE(SCHAU, ',','.') AS SCHAU, NOCONT, 
DREVISION, PEREVISION, ENTPRES, EDITAR, EDITDEC, TRIG, DENRGSORT, DEMISAVIS, DIMPQUITT, CACCESS, MOIPER, DATEFFET, DATFIN, TAXADD, REPLACE(TAUXRECUP, ',','.') AS TAUXRECUP, 
CQUABAIL, DGREV, REPLACE(SUTILE, ',','.') AS SUTILE, REPLACE(SCUTILE, ',','.') AS SCUTILE, INDEMOCC, REPLACE(COEF, ',','.') AS COEF, REPLACE(SREELLE, ',','.') AS SREELLE, 
REPLACE(SIMPOS, ',','.') AS SIMPOS, COPRO, EDITBAIL, REPLACE(POURCIDR, ',','.') AS POURCIDR, REPLACE(MTPREV, ',','.') AS MTPREV, REFINTERF, REPLACE(PRETMT, ',','.') AS PRETMT, 
PRETDEP, PRETOBJ, PRETDUR, MUTANT, REPLACE(DGDU, ',','.') AS DGDU, REPLACE(DGENC, ',','.') AS DGENC, ALERTE, MATYPTIERS, MATIERS, DATTACH, DDETACH, DFERME, 
REPLACE(MTMINICA, ',','.') AS MTMINICA, REPLACE(MTMAXICA, ',','.') AS MTMAXICA, REPLACE(PRCCA, ',','.') AS PRCCA, DGFACIAL, INDCONNU, LBAREMCA, PRISQUE, PFERME, PREAGES, CNUMI, DERTERM, INDREF, NAVENAN, 
--ISNULL(CASE WHEN LEN(DREVIS) = 8 THEN SUBSTRING(DREVIS, 7, 2) WHEN LEN(DREVIS) = 10 THEN SUBSTRING(DREVIS, 9, 2) END  + SUBSTRING(DREVIS, 4, 2) + LEFT(DREVIS, 2), '') AS DREVIS
CASE WHEN LEN(DREVIS) = 8 THEN convert(datetime, SUBSTRING(DREVIS, 7, 2) + substring(DREVIS, 4, 2) + substring(DREVIS, 1, 2), 103)
	 WHEN LEN(DREVIS) = 10 THEN convert(datetime, substring(DREVIS, 7, 4) + substring(DREVIS, 4, 2) + substring(DREVIS, 1, 2), 103) END AS DREVIS
, DECHEANCE, LTVA, LDIV, INDPREC, NBDG, LTRIENNAL, SIGETATS, LREVCAUT, LCLOCAUT, NBJCAUT, CMOTIF, NBPRCAU, CFTYPTIERS, RELANCE, TYPEDI, COMPENS, COCORG, COMANDAT, CODDEB, CODFIN, CFTIERS, COCTIERS, CFCONVOC, DFINBAIL, MACONVOC, NBJBAIL
, RPCONVOC, LOCIDR, CMANDAT, REPLACE(PRCPLAF, ',','.') AS PRCPLAF, REPLACE(PRCHONO, ',','.') AS PRCHONO, LDGTVA, CFISCAL, MIGCOMPT, CMOTIFNP, CMOTREP, TEMMAJ, DATMAJ, TEDCONG, DETDATE, LASSUR, LVIR, TYPTAUX, 
REPLACE(TAUXINT, ',','.') AS TAUXINT, CMOTIFDA, DEDITBAI, DELAIPAIEMENT, CMODPAI, DBASSIN, DSECTEUR, DCOMM, DPAYS, DDEPART, CENVOIAVIS, DEDITFACINOC, CTYPQUI, REVISNEG, EDELSOR, EDLENT, REPLACE(TAUXPLURI, ',','.') AS TAUXPLURI, DDEBPLAFPLURI, DFINPLAFPLURI, INDEXREFPLURI
FROM ESTIA_SOURCE..LOCATION
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MANSEC: TABLE DES MANSEC
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MANSEC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MANSEC
INSERT INTO ESTIA_MANSEC (CJOURNAL, CMANDAT, CMANDOM, CORG, CSECTANA, DDEB, DEPREC, DFIN, TRIG)
SELECT CJOURNAL, CMANDAT, CMANDOM, CORG, CSECTANA, DDEB, DEPREC, DFIN, TRIG
FROM ESTIA_SOURCE..MANSEC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MANGES: TABLE DES MANDATS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MANGES', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MANGES
INSERT INTO ESTIA_MANGES (CTYPTIERS, CTIERS, CMANDAT, REFMAND, CTYPMAN, NIVEAU, DATTRIB, DRENOUV, DCLOTURE, CMOTMAN, CONDFACT, ACTUAL, TRIG, LMANDAT, FACTURATION, NBMOIS, DSIGN, MONTANT, CTVA, CCATEG, HCATEG, DEFFET, CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, TXHONO, MTHONO, MTGARANT, TYPGARANT, COMMENT, VACANCE, PERIOD, DG, DUREE, DELAI, PERENOUV, PRIORITE, HONOCALC, REPRES, DESIGN, CCG, HORG, DFINGEST, MFDR, DFDR, MDEJAREV, CEMPLOY, PART, ASSPERT, CALCULAC, CTYPDECRF, CTYPDEDRF, DECTVA, DEREDD, EDITBOR, EDITDEP, EDITQUIT, EDITREP, EXIG, FORFACPTE, HONOCPTA, HONOFREQ, INDIVIS, MFINH, MFINR, MTFRDOS, NBDEP, NBREP, POUREV, PRESGEST, PRESQUIT, PRORATA, PROVHT, REGLE, REPORTINC, SOUMTVA, TAXADD, TERMNREL, TERMQUIT, VIRPROPR, CFREQAC, DREDD, DTERME, EXEMP, TEMPLOY, DISPO, ADRCOMP, CPOS, LIEUDIT, RUE, VILLE, SEUILMINI, CBANQUE, GUICHET, COMPTE, CONVOC, DDBRELANC, DFNRELANC, TERME, TPSPRE, DERACPTE, ISOLE, DECRL, DDEBMDT, DFINMDT, NIVREL, CMOTFDR, TYPEMDT, MIGCOMPT, CMANDOM, NMANDOM, PRIM1, PRIM2, PRIMCAL, REGLT, DVERCPT, CNUMI, DEFFETREVIS, DREVIS, DREVISION, INDPREC, INDREF, PEREVISION, TRIMIND, ADFPER, ADFREGUL, ADFTYPE, REMPLOY, ECRTVA)
SELECT CTYPTIERS, CTIERS, CMANDAT, REFMAND, CTYPMAN, NIVEAU, DATTRIB , DRENOUV, DCLOTURE,  CMOTMAN, CONDFACT, ACTUAL, TRIG, LMANDAT, FACTURATION, NBMOIS, 
CASE WHEN LEN(DSIGN) = 8 THEN convert(datetime, SUBSTRING(DSIGN, 7, 2) + substring(DSIGN, 4, 2) + substring(DSIGN, 1, 2), 103)
	 WHEN LEN(DSIGN) = 10 THEN convert(datetime, substring(DSIGN, 7, 4) + substring(DSIGN, 4, 2) + substring(DSIGN, 1, 2), 103) END AS DSIGN
, MONTANT, CTVA, CCATEG, HCATEG, 
CASE WHEN LEN(DEFFET) = 8 THEN convert(datetime, SUBSTRING(DEFFET, 7, 2) + substring(DEFFET, 4, 2) + substring(DEFFET, 1, 2), 103)
	 WHEN LEN(DEFFET) = 10 THEN convert(datetime, substring(DEFFET, 7, 4) + substring(DEFFET, 4, 2) + substring(DEFFET, 1, 2), 103) END AS DEFFET
, CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, TXHONO, MTHONO, MTGARANT, TYPGARANT, COMMENT_, VACANCE, PERIOD, DG, DUREE, DELAI, PERENOUV, PRIORITE, HONOCALC, REPRES, DESIGN, CCG, HORG, 
CASE WHEN LEN(DFINGEST) = 8 THEN convert(datetime, SUBSTRING(DFINGEST, 7, 2) + substring(DFINGEST, 4, 2) + substring(DFINGEST, 1, 2), 103)
	 WHEN LEN(DFINGEST) = 10 THEN convert(datetime, substring(DFINGEST, 7, 4) + substring(DFINGEST, 4, 2) + substring(DFINGEST, 1, 2), 103) END AS DFINGEST, 
MFDR, DFDR, MDEJAREV, CEMPLOY, PART, ASSPERT, CALCULAC, CTYPDECRF, CTYPDEDRF, DECTVA, 
CASE WHEN LEN(DEREDD) = 8 THEN convert(datetime, SUBSTRING(DEREDD, 7, 2) + substring(DEREDD, 4, 2) + substring(DEREDD, 1, 2), 103)
	 WHEN LEN(DEREDD) = 10 THEN convert(datetime, substring(DEREDD, 7, 4) + substring(DEREDD, 4, 2) + substring(DEREDD, 1, 2), 103) END AS DEREDD, 
EDITBOR, EDITDEP, EDITQUIT, EDITREP, EXIG, FORFACPTE, HONOCPTA, HONOFREQ, INDIVIS, MFINH, MFINR, MTFRDOS, NBDEP, NBREP, POUREV, PRESGEST, PRESQUIT, PRORATA, PROVHT, REGLE, REPORTINC, SOUMTVA, TAXADD, TERMNREL, TERMQUIT, VIRPROPR, CFREQAC, 
CASE WHEN LEN(DREDD) = 8 THEN convert(datetime, SUBSTRING(DREDD, 7, 2) + substring(DREDD, 4, 2) + substring(DREDD, 1, 2), 103)
	 WHEN LEN(DREDD) = 10 THEN convert(datetime, substring(DREDD, 7, 4) + substring(DREDD, 4, 2) + substring(DREDD, 1, 2), 103) END AS DREDD, 
DTERME, EXEMP, TEMPLOY, DISPO, ADRCOMP, CPOS, LIEUDIT, RUE, VILLE, SEUILMINI, CBANQUE, GUICHET, COMPTE, CONVOC, DDBRELANC, DFNRELANC, TERME, TPSPRE, DERACPTE, ISOLE, DECRL, DDEBMDT, DFINMDT, NIVREL, CMOTFDR, TYPEMDT, MIGCOMPT, CMANDOM, NMANDOM, PRIM1, PRIM2, PRIMCAL, REGLT, DVERCPT, CNUMI, DEFFETREVIS, DREVIS, DREVISION, INDPREC, INDREF, PEREVISION, TRIMIND, ADFPER, ADFREGUL, ADFTYPE, REMPLOY, ECRTVA
FROM ESTIA_SOURCE..MANGES
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MANPAT: TABLE DE RATTACHEMENT DU PATRIMOINE AUX MANDATS (NIVEAU SELON COLONNE NIVEAU SUR MANGES - G POUR GROUPE, I POUR IMMEUBLE ET L POUR LOCAL)
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MANPAT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MANPAT
INSERT INTO ESTIA_MANPAT (CTYPTIERS, CTIERS, CMANDAT, NIVEAU, CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, MTCOL1, MTCOL2, MTCOL3, MTCOL4, MTCOL5, MTCOL6, MTVENT, TRIG, MIGCOMPT, CMANDOM)
SELECT CTYPTIERS, CTIERS, CMANDAT, NIVEAU, CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, MTCOL1, MTCOL2, MTCOL3, MTCOL4, MTCOL5, MTCOL6, MTVENT, TRIG, MIGCOMPT, CMANDOM
FROM ESTIA_SOURCE..MANPAT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MANPROP: TABLE DES PROPRIETAIRES LIES AUX MANDATS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MANPROP', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MANPROP
INSERT INTO ESTIA_MANPROP (CMANDAT, CQUALPR, CTYPTIERS, CTIERS, PARTPROP, PARTREP, REGISTRE, REPRES, TRIG, CTIERSI, CTYPTIERSI, CORG, CCOMPTE, NOBAIL, CONVOC, NODOMR, NODOMA, DDEB, DFIN, MIGCOMPT, SUIVIASSU)
SELECT CMANDAT, CQUALPR, CTYPTIERS, CTIERS, PARTPROP, PARTREP, REGISTRE, REPRES, TRIG, CTIERSI, CTYPTIERSI, CORG, CCOMPTE, NOBAIL, CONVOC, NODOMR, NODOMA, DDEB, DFIN, MIGCOMPT, SUIVIASSU
FROM ESTIA_SOURCE..MANPROP
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MANTVA: TABLE D'HISTORIQUE DE PRORATA DE TVA PAR MANDAT
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MANTVA', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MANTVA
INSERT INTO ESTIA_MANTVA (CORG, CMANDAT, DDEB, DFIN, DEFFETD, TAUXD, TAUXP, TRIG)
SELECT CORG, CMANDAT, ISNULL(RIGHT(DDEB, 2) + SUBSTRING(DDEB, 4, 2) + LEFT(DDEB, 2), '') AS DDEB, DFIN, DEFFETD, TAUXD, TAUXP, TRIG
FROM ESTIA_SOURCE..MANTVA
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MENPRIN: TABLE 
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MENPRIN', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MENPRIN
INSERT INTO ESTIA_MENPRIN (UTIL, ADMIN, LISTAG, LISTORG, LUTIL)
SELECT UTIL, ADMIN, LISTAG, LISTORG, LUTIL
FROM ESTIA_SOURCE..MENPRIN
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--METREV: TABLE DES METHODES RE REVISION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('METREV', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_METREV
INSERT INTO ESTIA_METREV (CMETREV, LMETREV, TRIG, LACTIF)
SELECT CMETREV, LMETREV, TRIG, LACTIF
FROM ESTIA_SOURCE..METREV
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MODREG: TABLE DES MODES DE REGLEMENT
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MODREG', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MODREG
INSERT INTO ESTIA_MODREG (CMODREG, LMODREG, CTYPAI, TRIG, LACTIF)
SELECT CMODREG, LMODREG, CTYPAI, TRIG, LACTIF
FROM ESTIA_SOURCE..MODREG
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MOTDDE: TABLE DES MOTIFS DE CONGE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MOTDDE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MOTDDE
INSERT INTO ESTIA_MOTDDE (CMOTDDE, LMOTDDE, /*CEXTERNE, LGEXTERNE,*/ TRIG, POINT, REGROUP, LACTIF)
SELECT CMOTDDE, LMOTDDE, /*CEXTERNE, LGEXTERNE,*/ TRIG, POINT, REGROUP, LACTIF
FROM ESTIA_SOURCE..MOTDDE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MOTIF: TABLE DES MOTIFS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MOTIF', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MOTIF
INSERT INTO ESTIA_MOTIF (CSTE, CMOTIF, LMOTIF, TRIG, LMOTIFL, MIGCOMPT, LACTIF)
SELECT CSTE, CMOTIF, LMOTIF, TRIG, LMOTIFL, MIGCOMPT, LACTIF
FROM ESTIA_SOURCE..MOTIF
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--MOTVAC: TABLE DES MOTIFS DE VACANCE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('MOTVAC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_MOTVAC
INSERT INTO ESTIA_MOTVAC (CMOTVAC, LMOTVAC, TRIG, LACTIF)
SELECT CMOTVAC, LMOTVAC, TRIG, LACTIF
FROM ESTIA_SOURCE..MOTVAC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--NEGOCH: TABLE DES NEGOCIATIONS DE CHARGES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('NEGOCH', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_NEGOCH
INSERT INTO ESTIA_NEGOCH (CSTE, CORG, CCOMPTE, NOBAIL, CAGENCE, CGROUPE, CCRITDP, CSCRITDP, CIMMEUB, CLOCAL, OCC, CMETH, MONTANT, DIFF, TRIG)
SELECT CSTE, CORG, CCOMPTE, NOBAIL, CAGENCE, CGROUPE, CCRITDP, CSCRITDP, CIMMEUB, CLOCAL, OCC, CMETH, MONTANT, DIFF, TRIG
FROM ESTIA_SOURCE..NEGOCH
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--NATRUB: TABLE DES NATURES DE TARIF
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('NATRUB', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_NATRUB
INSERT INTO ESTIA_NATRUB (CNATRUB, LNATRUB, TRIG, LACTIF)
SELECT CNATRUB, LNATRUB, TRIG, LACTIF
FROM ESTIA_SOURCE..NATRUB
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--NUMI: TABLE DES INDICES DE REVISION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('NUMI', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_NUMI
INSERT INTO ESTIA_NUMI (CNUMI, LNUMI, PERIOD, TRIG, LACTIF)
SELECT CNUMI, LNUMI, PERIOD##1, TRIG, LACTIF
FROM ESTIA_SOURCE..NUMI
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--ORG: TABLE DES ORGANISATIONS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('ORG', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_ORG
INSERT INTO ESTIA_ORG (CORG, LORG, RSOC, RUE, LIEUDIT, CPOS, VILLE, CCOMM, SIRET, CAPE, TELPH, TELEX, FAX, CONSORG, DDEBEX, DFINEX, DDEB2EX, DFIN2EX, DDEB1EX, DFIN1EX, DDEBSEX, DFINSEX, DDERCLO, DDERCAN, TEMCLO, CONTACT, CFONCTIO, TEMPATRI, CDOMSOC, TRIG, DVOTE, INOM, IRUE, ILIEUDIT, IPOS, IVILLE, IBANQUE, IGUICHET, ICOMPTE, ILIBRIB, CPRESENT, DFICBAF, NOM, FCT, LIEU, CBAILLEUR, COTIERS, CIB, DFICDEC, DFICPUB, CNATGEST, FINACTIVITE, COTYPTIERS, CAPITAL, RESERVES, EMPRUNTS, CEXO, CEXO1, CEXO2, ASSUJ, NUMORG, PEGAS, TRIGD, ORGPROMO, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, RORG, TYPGEST, CARTPRO, REPRES, CSIREN, CSEQ, CARTET, CCATEG, CTIERS, CTYPTIERS, GATIERS, GATYPTIERS, LIMITEG, LIMITET, MTGARANT, VILLEG, VILLET, DGARANT, MTGAR1, IADRCOMP, ADRCOMP, TVACEE, D1FUSION, D2FUSION, SECTACT, ORGREF, HCATEG, CTYPIMP, EMAIL, RCS, ORG_ID, ADRESSE_ID, CEMETDEMUNIQ, MIROIR, REFERENCE)
SELECT CORG, LORG, RSOC, RUE, LIEUDIT, CPOS, VILLE, CCOMM, SIRET, CAPE, TELPH, TELEX, FAX, CONSORG, DDEBEX, DFINEX, DDEB2EX, DFIN2EX, DDEB1EX, DFIN1EX, DDEBSEX, DFINSEX, DDERCLO, DDERCAN, TEMCLO, CONTACT, CFONCTIO, TEMPATRI, CDOMSOC, TRIG, DVOTE, INOM, IRUE, ILIEUDIT, IPOS, IVILLE, IBANQUE, IGUICHET, ICOMPTE, ILIBRIB, CPRESENT, DFICBAF, NOM, FCT, LIEU, CBAILLEUR, COTIERS, CIB, DFICDEC, DFICPUB, CNATGEST, FINACTIVITE, COTYPTIERS, CAPITAL, RESERVES, EMPRUNTS, CEXO, CEXO1, CEXO2, ASSUJ, NUMORG, PEGAS, TRIGD, ORGPROMO, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, RORG, TYPGEST, CARTPRO, REPRES, CSIREN, CSEQ, CARTET, CCATEG, CTIERS, CTYPTIERS, GATIERS, GATYPTIERS, LIMITEG, LIMITET, MTGARANT, VILLEG, VILLET, DGARANT, MTGAR1, IADRCOMP, ADRCOMP, TVACEE, D1FUSION, D2FUSION, SECTACT, ORGREF, HCATEG, CTYPIMP, EMAIL, RCS, ORG_ID, ADRESSE_ID, CEMETDEMUNIQ, MIROIR, REFERENCE
FROM ESTIA_SOURCE..ORG
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PDEPOP: TABLE DE DEPENSES REELLES D'UNE OPERATION table non utilisee par SWISS LIFE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PDEPOP', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PDEPOP
INSERT INTO ESTIA_PDEPOP (CORG, COPE, CDEPR, MTINI, CTVA, CFOUR, MTCAU, POURCRG, NANTIS, MARSIGN, MTPEN, TEMRJ, CFOURP, PRORATA, DMLEV, RESERV, DLRESERV, NORD, DLAIJOUR, JPDLAI, TEMAPP, LNORD, SITUAT, SUIVI, TOTMIL, ANCPT, MOCPT, EDISIT, ACTUA, REVIS, COEFIX, COEFVA, SOUMIS, CAGENCE, CMODREG, CAGENCEB, CFOURB, DATLIB, ANBAS, MOBAS, MTSSTRAITE, TEMCP, NOAVTS, MTLIB, DTLIB, DORS, STRAIT, TTIERS, PDIRECT, DEFFET, JURID, CALCRG, UTILRET, TAUXRET, CTRANCHE, ASPOL, ASCON, ASDAT, DRECEPT, DDECOMP, DNOTIF, DGAP, LIB, RLIB, CPHASE, CASSUR, CBANQUE, GUICHET, CCOMPTE, RIB, COMMENT, CTYPVIR, CDECALA, CDECALD, DUREE, REPERE, CTYPPREL, CTYPDAT, TYPE, RG, MTCONV, DEVISE, MTTTCCONV, DDERSIT, RABAIS, PROLASM, TEMOIN, MIXTE, ACOUV, CCOUV, DEBENC, MTTCINI, CRITLIB1, CRITLIB2, CRITLIB3, PXMIL, CTIERSB, TXPRESTA, TEMPRESTA, DDEXEC, DFINPREV, PAVANC, REMUMOD, REMUFOR, DMARNOT, FRACTR, FRACBC, GRPT, NATAV, CMODCOMP, GESTCOMP, CODNAT, CLEIBAN, MIGCOMPT, COORDBANQ_ID, EXHONO, CCORETA, TRIG, CTYPAVANCE, POURCAVANCE, NBMOISACTU, DDERMAJ)
SELECT CORG, COPE, CDEPR, REPLACE(MTINI, ',','.') AS MTINI, CTVA, CFOUR, REPLACE(MTCAU, ',','.') AS MTCAU, REPLACE(POURCRG, ',','.') AS POURCRG, NANTIS, MARSIGN, REPLACE(MTPEN, ',','.') AS MTPEN, TEMRJ, CFOURP, PRORATA, DMLEV, RESERV, DLRESERV, NORD, DLAIJOUR, JPDLAI, TEMAPP, LNORD, SITUAT, SUIVI, TOTMIL, ANCPT, MOCPT, EDISIT, ACTUA, REVIS, COEFIX, COEFVA, SOUMIS, CAGENCE, CMODREG, CAGENCEB, CFOURB, DATLIB, ANBAS, MOBAS, MTSSTRAITE, TEMCP, NOAVTS, MTLIB, DTLIB, DORS, STRAIT, TTIERS, PDIRECT, DEFFET, JURID, CALCRG, [utilret 1 ], [TAUXRET 1 ], CTRANCHE, ASPOL, ASCON, ASDAT, DRECEPT, DDECOMP, DNOTIF, DGAP, LIB, RLIB, CPHASE, CASSUR, CBANQUE, GUICHET, CCOMPTE, RIB, COMMENT, CTYPVIR, CDECALA, CDECALD, DUREE, REPERE, CTYPPREL, CTYPDAT, TYPE, RG, MTCONV, DEVISE, MTTTCCONV, DDERSIT, RABAIS, PROLASM, TEMOIN, MIXTE, ACOUV, CCOUV, DEBENC, MTTCINI, CRITLIB1, CRITLIB2, CRITLIB3, PXMIL, CTIERSB, TXPRESTA, TEMPRESTA, DDEXEC, DFINPREV, PAVANC, REMUMOD, REMUFOR, DMARNOT, FRACTR, FRACBC, GRPT, NATAV, CMODCOMP, GESTCOMP, CODNAT, CLEIBAN, MIGCOMPT, COORDBANQ_ID, EXHONO, CCORETA, TRIG, CTYPAVANCE, POURCAVANCE, NBMOISACTU, DDERMAJ
FROM ESTIA_SOURCE..PDEPOP--SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PABASIT: TABLE D'HISTORIQUE DES ABATEMENTS POUR SITUATIONS PROMOTION
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PABASIT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PABASIT
INSERT INTO ESTIA_PABASIT (CORG, COPE, CDEPR, NORD, SITUAT, NOLIG, LIB, MT, TYPE, CFOUR, DECR, DSIGN, MTTVA, MTTTC, FORMPX, DSOUMIS, DORDS, TRIGD, MTVALASM, MTTCLASM, HTBASE, CTRANCHE, DEFFET, TEMIMPUT, CPHASE, TEMIGRA, CMOTIF, HTD, CNATPRES, CNOMENM, DCOMNOT, NOCOMM, DDEXEC, DELAI, MIGCOMPT)
SELECT CORG, COPE, CDEPR, NORD, SITUAT, NOLIG, LIB, REPLACE(MT, ',','.') AS MT, TYPE, CFOUR, DECR, DSIGN, REPLACE(MTTVA, ',','.') AS MTTVA, REPLACE(MTTTC, ',','.') AS MTTTC, FORMPX, DSOUMIS, DORDS, TRIGD, REPLACE(MTVALASM, ',','.') AS MTVALASM, REPLACE(MTTCLASM, ',','.') AS MTTCLASM, REPLACE(HTBASE, ',','.') AS HTBASE, CTRANCHE, DEFFET, TEMIMPUT, CPHASE, TEMIGRA, CMOTIF, HTD, CNATPRES, CNOMENM, DCOMNOT, NOCOMM, DDEXEC, DELAI, MIGCOMPT
FROM ESTIA_SOURCE..PABASIT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PAYS: TABLE DES PAYS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PAYS', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PAYS
INSERT INTO ESTIA_PAYS (CPAYS, LPAYS, TRIG, REFERENCE, PAYS_ID, MIGCOMPT, LACTIF, CPAYSBIC, LONGIBAN, PLANCALQUE, PLANIDGRAPHIQUE, PRESCPOS, LONGPOS)
SELECT CPAYS, LPAYS, TRIG, REFERENCE, PAYS_ID, MIGCOMPT, LACTIF, CPAYSBIC, LONGIBAN, PLANCALQUE, PLANIDGRAPHIQUE, PRESCPOS, LONGPOS
FROM ESTIA_SOURCE..PAYS
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PCRITDEP: VENTILATION DES POSTES DE DEPENSE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PCRITDEP', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PCRITDEP
INSERT INTO ESTIA_PCRITDEP (CORG, COPE, CTRANCHE, CDEPR, NORD, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CCRITDP, CSCRITDP, POURC, BANAL)
SELECT CORG, COPE, CTRANCHE, CDEPR, NORD, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, CCRITDP, CSCRITDP, POURC, BANAL
FROM ESTIA_SOURCE..PCRITDEP
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PDEPR: Postes de dépenses GO
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PDEPR', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PDEPR
INSERT INTO ESTIA_PDEPR (CDEPR,LDEPR,MARCHE,CDEPP,CNATDEP,MASSE,CMASSE,DEBENC,TRAVPRE,LISTTYP,CNATANA,CCRITDP,TEMTRAV,CCOMPOSA,CMODCOMP,GESTCOMP,LACTIF,
						 EXHONO,HCRITDP,FNPCRITDP,FNPHCRITDP,TEMTRVPREFI)
SELECT CDEPR,LDEPR,MARCHE,CDEPP,CNATDEP,MASSE,CMASSE,DEBENC,TRAVPRE,LISTTYP,CNATANA,CCRITDP,TEMTRAV,CCOMPOSA,CMODCOMP,GESTCOMP,LACTIF,
						 EXHONO,HCRITDP,FNPCRITDP,FNPHCRITDP,TEMTRVPREFI
FROM ESTIA_SOURCE..PDEPR
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PERIODICITE: TABLE DES PERIODICITES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PERIODICITE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PERIODICITE
INSERT INTO ESTIA_PERIODICITE (CPERIODICITE, LPERIODICITE, TRIG, MIGCOMPT, LACTIF)
SELECT CPERIODICITE, LPERIODICITE, TRIG, MIGCOMPT, LACTIF
FROM ESTIA_SOURCE..PERIODICITE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PIOPE: TABLE DES INTERVENANTS DES OPERATIONS (CHANTIERS)
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PIOPE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PIOPE 
INSERT INTO ESTIA_PIOPE (CORG,COPE,NTIERS,CTVA,DDCOM,DFCOM,CPTVENT,TRESP,CNATPROD,NBJR1,NBJR2,VETIERS
,PTIERS,DETTIERS,CTRANCHE,ASSUTVA,CBORDERO,CJOURNAL,DEBENC,CTYPDEST,PAICJOURNAL
,PAICBORDERO,PRORATA,LDECID,DDECID,DSAD,LASMCTVA,LPRORATA,MIXTE,DDEFLASM,NUMINT
,NUMDDE,DAGRE,TXLASM,SHONTOT,SHABTOT,SANXTOT,MILTOT,NBLGT,CAPREV,MTACQ,NBACQ
,CPRODUIT,CPROD,CNATOP,CETUDE,CNATTRAV,PRCAVTEC,PRCFNPHONO,PRCAVCHANTIER)
SELECT CORG,COPE,NTIERS,CTVA,DDCOM,DFCOM,CPTVENT,TRESP,CNATPROD,NBJR1,NBJR2,VETIERS
,PTIERS,DETTIERS,CTRANCHE,ASSUTVA,CBORDERO,CJOURNAL,DEBENC,CTYPDEST,PAICJOURNAL
,PAICBORDERO,PRORATA,LDECID,DDECID,DSAD,LASMCTVA,LPRORATA,MIXTE,DDEFLASM,NUMINT
,NUMDDE,DAGRE,TXLASM,SHONTOT,SHABTOT,SANXTOT,MILTOT,NBLGT,CAPREV,MTACQ,NBACQ
,CPRODUIT,CPROD,CNATOP,CETUDE,CNATTRAV,PRCAVTEC,PRCFNPHONO,PRCAVCHANTIER
FROM ESTIA_SOURCE..PIOPE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--PLOCAL: TABLE DES LOCAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('PLOCAL', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_PLOCAL
INSERT INTO ESTIA_PLOCAL (CORG, CAGENCE, CGROUPE, CIMMEUB, CPLOCAL, ESC, ETAGE, SCORR, SHAB, CTYPLOG, CNATLOG, TEMPATRI, RUE, LIEUDIT, CPOS, CAVE, BAT, PORTE, SGAR, VILLE, DEBLOC, CENTR, CSITU, TXDIM, TXMAJ, DATTRAV, DFINTXS, DFINTXP, DFINTXR, DURTRAV, PARK, GARAGE, CHAUFF, LOGCOM, CCATHLM, CVIDORD, ASCENS, INDCOL, LOGSOC, SCHAU, JARDIN, CCOMM, SCALC, GCENTR, GCSITU, GTXDIM, GTXMAJ, SUTILE, SCUTILE, SANNEXE, DECOMPTE, CUTIL, DMAJ, CCATIMM, LINDCOL, REFIMP, CDEPART, CFINANC, CHANDI, CUSALOC, CQUART, CSECTEUR, CZONE, CBASSIN, TRIG, SREELLE, SIMPOS, LPLOCAL, COPE, CCONVSU, COEF, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, CSERVI1, CSERVI2, CEMPLOY1, CEMPLOY2, CARROND, ADRCOMP, CTYPQUAR, CFINORI, CONVDSU, CLOCCONT, MIGCOMPT, CPHASENT, DPHASENT, CPHASSOR, DPHASSOR, CETAGE, PREMANN, SOUMTFPB, ADRESSE_ID, ALLEE, CHAUFFAGE, CLIMATISATION, COMMUN, DUPLEX, GESTIONTECH, HAUTEUR, IMMEUB_ID, NBPIECES, PLOCAL_ID, SURFDISPONIBLE, SURFGRAPHIQUE, SURFPIECEGRAPHIQUE, SURFVITREE, VIDORDURE, MOTIOCCUPATION, CTYPOCCUP, REMOCCUP, CMOTINOCCUP, REMINOCCUP, ARCHIVE, DFINML, DDEBHAL, DATACHAT, PRTYPTIERS, PRTIERS, NOTYPTIERS, NOTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, DVENTE, DATEVAL, DAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DOTYPTIERS, DOTIERS, IDPRGES, DDCONS, DFINCONS, DREHAB, CTYPPROP, DPREVENT, DATAUTO, DDEBPAL, DATESORTIE, CMOTSORTIE, DPREVACHAT)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CPLOCAL, ESC, ETAGE, REPLACE(SCORR, ',','.') AS SCORR, REPLACE(SHAB, ',','.') AS SHAB, CTYPLOG, CNATLOG, TEMPATRI, RUE, LIEUDIT, CPOS, CAVE, BAT, PORTE, REPLACE(SGAR, ',','.') AS SGAR, VILLE, DEBLOC, REPLACE(CENTR, ',','.') AS CENTR, REPLACE(CSITU, ',','.') AS CSITU, REPLACE(TXDIM, ',','.') AS TXDIM, REPLACE(TXMAJ, ',','.') AS TXMAJ, DATTRAV, DFINTXS, DFINTXP, DFINTXR, DURTRAV, PARK, GARAGE, CHAUFF, LOGCOM, CCATHLM, CVIDORD, ASCENS, INDCOL, LOGSOC, SCHAU, JARDIN, CCOMM, SCALC, REPLACE(GCENTR, ',','.') AS GCENTR, REPLACE(GCSITU, ',','.') AS GCSITU, REPLACE(GTXDIM, ',','.') AS GTXDIM, REPLACE(GTXMAJ, ',','.') AS GTXMAJ, REPLACE(SUTILE, ',','.') AS SUTILE, REPLACE(SCUTILE, ',','.') AS SCUTILE, REPLACE(SANNEXE, ',','.') AS SANNEXE, DECOMPTE, CUTIL, DMAJ, CCATIMM, LINDCOL, REFIMP, CDEPART, CFINANC, CHANDI, CUSALOC, CQUART, CSECTEUR, CZONE, CBASSIN, TRIG, REPLACE(SREELLE, ',','.') AS SREELLE, REPLACE(SIMPOS, ',','.') AS SIMPOS, LPLOCAL, COPE, CCONVSU, REPLACE(COEF, ',','.') AS COEF, PEGAS, TRIGD, NOMBMP, XPLAN, YPLAN, LPLAN, HPLAN, CSERVI1, CSERVI2, CEMPLOY1, CEMPLOY2, CARROND, ADRCOMP, CTYPQUAR, CFINORI, CONVDSU, CLOCCONT, MIGCOMPT, CPHASENT, DPHASENT, CPHASSOR, DPHASSOR, CETAGE, PREMANN, SOUMTFPB, ADRESSE_ID, ALLEE, CHAUFFAGE, CLIMATISATION, COMMUN, DUPLEX, GESTIONTECH, HAUTEUR, IMMEUB_ID, NBPIECES, PLOCAL_ID, SURFDISPONIBLE, SURFGRAPHIQUE, SURFPIECEGRAPHIQUE, SURFVITREE, VIDORDURE, MOTIOCCUPATION, CTYPOCCUP, REMOCCUP, CMOTINOCCUP, REMINOCCUP, ARCHIVE, DFINML, DDEBHAL, DATACHAT, PRTYPTIERS, PRTIERS, NOTYPTIERS, NOTIERS, VOTYPTIERS, VOTIERS, MTVEN, MTACHAT, DVENTE, DATEVAL, DAUTO, PRXVENT, PRXPLAN, ACTYPTIERS, ACTIERS, DOTYPTIERS, DOTIERS, IDPRGES, DDCONS, DFINCONS, DREHAB, CTYPPROP, DPREVENT, DATAUTO, DDEBPAL, DATESORTIE, CMOTSORTIE, DPREVACHAT
FROM ESTIA_SOURCE..PLOCAL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--POPE: TABLE DES OPERATIONS (CHANTIERS) table non utilisee
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('POPE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_POPE
INSERT INTO ESTIA_POPE (CORG, COPE, LOPE, RUE, LIEUDIT, VILLE, CPOS, CCOMM, DACQ, MTACQ, MTFRACQ, NTIERS, ACTIV, COMMENT, CTVA, COMPTENGA, DORS, CPTVENT, DOCHAN, ADCHAN, MDCHAN, DDCOM, DFCOM, DPV, DDD, DFGAR, MTPAPGR, NUMOC, DPRELIM, DAUTOR, DLANCOP, DEPIECE, PERSTDEF, DERPERST, DACHEV, CSCHEMREF, CTIERS, CAGENCE, IOUC, DDGAR, DASSYN, STIERS, DCLOTU, CSECTCLI, CZGEO, SHONTOT, SHABTOT, NBRECEP, DREF, SANXTOT, SCORTOTC, SCORTOTR, DPREC, MTIERS, CBANQUE, CFPAP, VTIERS, DCERTIF, DDOSLOC, DMHEAU, DDPLOC, CFINPAL, NOMTECH, DDECFIN, NDECFIN, DEFFIN, NOCONV, TRESP, MRESP, MTCOMM, POURCOMM, CNATPROD, ATIERS, VISUTVA, MTX, MTSTI, DDLOC, ANCNEUF, PXLOYM2, NBLGT, DLIV, MISSION, DSIGCON, TXHON, CPRES, NATURE, NBJR1, NBJR2, CFI, RISQUE, FENGAGE, PRESIDAS, DESPVERT, BETIERS, BCTIERS, IGTIERS, ASTIERS, COOTIERS, GTIERS, SLOTTOT, UNITTOT, MILTOT, CSTE, VETIERS, REFCONT, CCPTE, PTIERS, COMVE, REMPRES, PRIMPAR, DETTIERS, DPORS, DPDD, DPCLOTU, DPLIV, CTYPOP, CASMOD, ASSUTVA, DESTOCK, DPACHEV, CTRANCHE, PRORATA, LDECID, DDECID, TEMOIN, DSAD, LASMCTVA, LPRORATA, MIXTE, DDEFLASM, CPAYS, CAPREV, ETAT, CBORDERO, CJOURNAL, CETAT, TYPE, DEBENC, CTYPDEST, PAICJOURNAL, PAICBORDERO, DDSTK, NBACQ, CRITLIB1, CRITLIB2, CRITLIB3, MASQUEE, ADRCOMP, CFISCAL, CMANDAT, CGROUPE, CIMMEUB
)
SELECT CORG, COPE, LOPE, RUE, LIEUDIT, VILLE, CPOS, CCOMM, DACQ, REPLACE(MTACQ, ',','.') AS MTACQ, REPLACE(MTFRACQ, ',','.') AS MTFRACQ, NTIERS, ACTIV, COMMENT_, CTVA, COMPTENGA, DORS, CPTVENT, 
CASE WHEN LEN(DOCHAN) = 8 THEN convert(datetime, SUBSTRING(DOCHAN, 7, 2) + substring(DOCHAN, 4, 2) + substring(DOCHAN, 1, 2), 103)
	 WHEN LEN(DOCHAN) = 10 THEN convert(datetime, substring(DOCHAN, 7, 4) + substring(DOCHAN, 4, 2) + substring(DOCHAN, 1, 2), 103) END AS DOCHAN, 
ADCHAN, MDCHAN, DDCOM, DFCOM, DPV,DDD,
CASE WHEN LEN(DFGAR) = 8 THEN convert(datetime, SUBSTRING(DFGAR, 7, 2) + substring(DFGAR, 4, 2) + substring(DFGAR, 1, 2), 103)
	 WHEN LEN(DFGAR) = 10 THEN convert(datetime, substring(DFGAR, 7, 4) + substring(DFGAR, 4, 2) + substring(DFGAR, 1, 2), 103) END AS DFGAR,
REPLACE(MTPAPGR, ',','.') AS MTPAPGR, NUMOC, DPRELIM, DAUTOR, DLANCOP, DEPIECE, PERSTDEF, DERPERST, DACHEV, CSCHEMREF, CTIERS, CAGENCE, IOUC, DDGAR, DASSYN, STIERS, DCLOTU, CSECTCLI, CZGEO, REPLACE(SHONTOT, ',','.') AS SHONTOT, REPLACE(SHABTOT, ',','.') AS SHABTOT, NBRECEP, 
CASE WHEN LEN(DREF) = 8 THEN convert(datetime, SUBSTRING(DREF, 7, 2) + substring(DREF, 4, 2) + substring(DREF, 1, 2), 103)
	 WHEN LEN(DREF) = 10 THEN convert(datetime, substring(DREF, 7, 4) + substring(DREF, 4, 2) + substring(DREF, 1, 2), 103) END AS DREF, 
REPLACE(SANXTOT, ',','.') AS SANXTOT, REPLACE(SCORTOTC, ',','.') AS SCORTOTC, REPLACE(SCORTOTR, ',','.') AS SCORTOTR, 
CASE WHEN LEN(DPREC) = 8 THEN convert(datetime, SUBSTRING(DPREC, 7, 2) + substring(DPREC, 4, 2) + substring(DPREC, 1, 2), 103)
	 WHEN LEN(DPREC) = 10 THEN convert(datetime, substring(DPREC, 7, 4) + substring(DPREC, 4, 2) + substring(DPREC, 1, 2), 103) END AS DPREC, 
MTIERS, CBANQUE, REPLACE(CFPAP, ',','.') AS CFPAP, VTIERS, DCERTIF, 
CASE WHEN LEN(DDOSLOC) = 8 THEN convert(datetime, SUBSTRING(DDOSLOC, 7, 2) + substring(DDOSLOC, 4, 2) + substring(DDOSLOC, 1, 2), 103)
	 WHEN LEN(DDOSLOC) = 10 THEN convert(datetime, substring(DDOSLOC, 7, 4) + substring(DDOSLOC, 4, 2) + substring(DDOSLOC, 1, 2), 103) END AS DDOSLOC, 
CASE WHEN LEN(DMHEAU) = 8 THEN convert(datetime, SUBSTRING(DMHEAU, 7, 2) + substring(DMHEAU, 4, 2) + substring(DMHEAU, 1, 2), 103)
	 WHEN LEN(DMHEAU) = 10 THEN convert(datetime, substring(DMHEAU, 7, 4) + substring(DMHEAU, 4, 2) + substring(DMHEAU, 1, 2), 103) END AS DMHEAU, 
CASE WHEN LEN(DDPLOC) = 8 THEN convert(datetime, SUBSTRING(DDPLOC, 7, 2) + substring(DDPLOC, 4, 2) + substring(DDPLOC, 1, 2), 103)
	 WHEN LEN(DDPLOC) = 10 THEN convert(datetime, substring(DDPLOC, 7, 4) + substring(DDPLOC, 4, 2) + substring(DDPLOC, 1, 2), 103) END AS DDPLOC, 
CFINPAL, NOMTECH, 
CASE WHEN LEN(DDECFIN) = 8 THEN convert(datetime, SUBSTRING(DDECFIN, 7, 2) + substring(DDECFIN, 4, 2) + substring(DDECFIN, 1, 2), 103)
	 WHEN LEN(DDECFIN) = 10 THEN convert(datetime, substring(DDECFIN, 7, 4) + substring(DDECFIN, 4, 2) + substring(DDECFIN, 1, 2), 103) END AS DDECFIN, 
NDECFIN, 
CASE WHEN LEN(DEFFIN) = 8 THEN convert(datetime, SUBSTRING(DEFFIN, 7, 2) + substring(DEFFIN, 4, 2) + substring(DEFFIN, 1, 2), 103)
	 WHEN LEN(DEFFIN) = 10 THEN convert(datetime, substring(DEFFIN, 7, 4) + substring(DEFFIN, 4, 2) + substring(DEFFIN, 1, 2), 103) END AS DEFFIN, 
NOCONV, TRESP, MRESP, REPLACE(MTCOMM, ',','.') AS MTCOMM, REPLACE(POURCOMM, ',','.') AS POURCOMM, CNATPROD, ATIERS, VISUTVA, MTX, REPLACE(MTSTI, ',','.') AS MTSTI, 
CASE WHEN LEN(DDLOC) = 8 THEN convert(datetime, SUBSTRING(DDLOC, 7, 2) + substring(DDLOC, 4, 2) + substring(DDLOC, 1, 2), 103)
	 WHEN LEN(DDLOC) = 10 THEN convert(datetime, substring(DDLOC, 7, 4) + substring(DDLOC, 4, 2) + substring(DDLOC, 1, 2), 103) END AS DDLOC, 
ANCNEUF, REPLACE(PXLOYM2, ',','.') AS  PXLOYM2, NBLGT, 
DLIV, 
MISSION, 
CASE WHEN LEN(DSIGCON) = 8 THEN convert(datetime, SUBSTRING(DSIGCON, 7, 2) + substring(DSIGCON, 4, 2) + substring(DSIGCON, 1, 2), 103)
	 WHEN LEN(DSIGCON) = 10 THEN convert(datetime, substring(DSIGCON, 7, 4) + substring(DSIGCON, 4, 2) + substring(DSIGCON, 1, 2), 103) END AS DSIGCON, 
REPLACE(TXHON, ',','.') AS TXHON, CPRES, NATURE, NBJR1, NBJR2, CFI, REPLACE(RISQUE, ',','.') AS RISQUE, REPLACE(FENGAGE, ',','.') AS FENGAGE, PRESIDAS, 
CASE WHEN LEN(DESPVERT) = 8 THEN convert(datetime, SUBSTRING(DESPVERT, 7, 2) + substring(DESPVERT, 4, 2) + substring(DESPVERT, 1, 2), 103)
	 WHEN LEN(DESPVERT) = 10 THEN convert(datetime, substring(DESPVERT, 7, 4) + substring(DESPVERT, 4, 2) + substring(DESPVERT, 1, 2), 103) END AS DESPVERT, 
BETIERS, BCTIERS, IGTIERS, ASTIERS, COOTIERS, GTIERS, REPLACE(SLOTTOT, ',','.') AS SLOTTOT, REPLACE(UNITTOT, ',','.') AS UNITTOT, REPLACE(MILTOT, ',','.') AS MILTOT, CSTE, VETIERS, REFCONT, CCPTE, PTIERS, REPLACE(COMVE, ',','.') AS COMVE, REPLACE(REMPRES, ',','.') AS REMPRES, REPLACE(PRIMPAR, ',','.') AS PRIMPAR, DETTIERS, 
CASE WHEN LEN(DPORS) = 8 THEN convert(datetime, SUBSTRING(DPORS, 7, 2) + substring(DPORS, 4, 2) + substring(DPORS, 1, 2), 103)
	 WHEN LEN(DPORS) = 10 THEN convert(datetime, substring(DPORS, 7, 4) + substring(DPORS, 4, 2) + substring(DPORS, 1, 2), 103) END AS DPORS, 
CASE WHEN LEN(DPDD) = 8 THEN convert(datetime, SUBSTRING(DPDD, 7, 2) + substring(DPDD, 4, 2) + substring(DPDD, 1, 2), 103)
	 WHEN LEN(DPDD) = 10 THEN convert(datetime, substring(DPDD, 7, 4) + substring(DPDD, 4, 2) + substring(DPDD, 1, 2), 103) END AS DPDD, 
CASE WHEN LEN(DPCLOTU) = 8 THEN convert(datetime, SUBSTRING(DPCLOTU, 7, 2) + substring(DPCLOTU, 4, 2) + substring(DPCLOTU, 1, 2), 103)
	 WHEN LEN(DPCLOTU) = 10 THEN convert(datetime, substring(DPCLOTU, 7, 4) + substring(DPCLOTU, 4, 2) + substring(DPCLOTU, 1, 2), 103) END AS DPCLOTU, 
CASE WHEN LEN(DPLIV) = 8 THEN convert(datetime, SUBSTRING(DPLIV, 7, 2) + substring(DPLIV, 4, 2) + substring(DPLIV, 1, 2), 103)
	 WHEN LEN(DPLIV) = 10 THEN convert(datetime, substring(DPLIV, 7, 4) + substring(DPLIV, 4, 2) + substring(DPLIV, 1, 2), 103) END AS DPLIV, 
CTYPOP, CASMOD, ASSUTVA, DESTOCK, 
CASE WHEN LEN(DPACHEV) = 8 THEN convert(datetime, SUBSTRING(DPACHEV, 7, 2) + substring(DPACHEV, 4, 2) + substring(DPACHEV, 1, 2), 103)
	 WHEN LEN(DPACHEV) = 10 THEN convert(datetime, substring(DPACHEV, 7, 4) + substring(DPACHEV, 4, 2) + substring(DPACHEV, 1, 2), 103) END AS DPACHEV, 
CTRANCHE, REPLACE(PRORATA, ',','.') AS PRORATA, LDECID, 
CASE WHEN LEN(DDECID) = 8 THEN convert(datetime, SUBSTRING(DDECID, 7, 2) + substring(DDECID, 4, 2) + substring(DDECID, 1, 2), 103)
	 WHEN LEN(DDECID) = 10 THEN convert(datetime, substring(DDECID, 7, 4) + substring(DDECID, 4, 2) + substring(DDECID, 1, 2), 103) END AS DDECID, 
TEMOIN, 
CASE WHEN LEN(DSAD) = 8 THEN convert(datetime, SUBSTRING(DSAD, 7, 2) + substring(DSAD, 4, 2) + substring(DSAD, 1, 2), 103)
	 WHEN LEN(DSAD) = 10 THEN convert(datetime, substring(DSAD, 7, 4) + substring(DSAD, 4, 2) + substring(DSAD, 1, 2), 103) END AS DSAD, 
LASMCTVA, REPLACE(LPRORATA, ',','.') AS LPRORATA, MIXTE, 
DDEFLASM, 
CPAYS, REPLACE(CAPREV, ',','.') AS CAPREV, ETAT, CBORDERO, CJOURNAL, CETAT, TYPE, DEBENC, CTYPDEST, PAICJOURNAL, PAICBORDERO, 
CASE WHEN LEN(DDSTK) = 8 THEN convert(datetime, SUBSTRING(DDSTK, 7, 2) + substring(DDSTK, 4, 2) + substring(DDSTK, 1, 2), 103)
	 WHEN LEN(DDSTK) = 10 THEN convert(datetime, substring(DDSTK, 7, 4) + substring(DDSTK, 4, 2) + substring(DDSTK, 1, 2), 103) END AS DDSTK, 
NBACQ, CRITLIB1, CRITLIB2, CRITLIB3, MASQUEE, ADRCOMP, CFISCAL, CMANDAT, CGROUPE, CIMMEUB
FROM ESTIA_SOURCE..POPE
--SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--POPS1: Ligne de budget GO
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('POPS1', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_POPS1
INSERT INTO ESTIA_POPS1 (CORG,COPE,VER,CDEPP,MTHT,MTTTC,CDEPT,CTVA,DEPREC,CDEPG,TYPE,DEFFET,LIB,CTRANCHE,MTVALASM,MTVA,STVA,CPHASE,POURC,AVHT,DETREG,HTD,MTACTU,MTREVI,VARC1,VARC2,VARD1,VARD2,COMMENT,CPMCAL,LSOURCE,VALEUR,CBANAL)
SELECT CORG,COPE,VER,CDEPP,REPLACE(MTHT, ',','.') AS MTHT,REPLACE(MTTTC, ',','.') AS MTTTC,CDEPT,CTVA,DEPREC,CDEPG,TYPE,DEFFET,LIB,CTRANCHE,REPLACE(MTVALASM, ',','.') AS MTVALASM,REPLACE(MTVA, ',','.') AS MTVA,STVA,CPHASE,REPLACE(POURC, ',','.') AS POURC,REPLACE(AVHT, ',','.') AS AVHT,DETREG,REPLACE(HTD, ',','.') AS HTD,REPLACE(MTACTU, ',','.') AS MTACTU,REPLACE(MTREVI, ',','.') AS MTREVI,VARC1,VARC2,REPLACE(VARD1, ',','.') AS VARD1,REPLACE(VARD2, ',','.') AS VARD2,COMMENT_,CPMCAL,LSOURCE,REPLACE(VALEUR, ',','.') AS VALEUR,CBANAL
FROM ESTIA_SOURCE..POPS1
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--QC: TABLE DES QUALITES CIVILES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('QC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_QC
INSERT INTO ESTIA_QC (CQC, LQC, TRIG, SEXE, TQC, CNP, LCOURRIER, LACTIF)
SELECT CQC, LQC, TRIG, SEXE, TQC, CNP, LCOURRIER, LACTIF
FROM ESTIA_SOURCE..QC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--RUB: TABLE DES RUBRIQUES DE QUITTANCEMENT
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('RUB', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_RUB
INSERT INTO ESTIA_RUB (CRUB, LRUB, CNATRUB, SENS, TPSPRE, RTOTAVIS, TEMREGUL, CMETHCAL, TEMBAIL, SORTI, QUITT, ECHEANCE, NOORD, ERUB, DDEBLOC, TRIG, CRUBTAX, /*NCOLEDIT,*/ EDITDEM, LOYPRIN, CTYPTAX, CTASS, PRELEV, NATAPL, DRUB, /*NCOLECRAN,*/ CMETARR, TEMIMP, RRUB, ARUB, NORDEC, LIBANNEXE, COMPVAC, CNATANA, TXEFFORT, CRUPTURE, REVERSE, AREVERSER, DECOMPTE, LIDR, LHONO, LGARANT, TRUB, BRUB, SRUB, CNUMI, PEREVISION, TRIMIND, CBASE, LOCCOP, PRUB, MRUB, CTRLBUD, CNATHON, CTRLEXO, HRUB, XRUB, LREVIS, FRUB, RTASS, PRIORO, PRIORT, CCHAPITRE, CLETTRF, CREGCPTE, HONAUTRE, REGREPART, REGRF, COPRO, LIBIS, NRUB, IRUB1, IRUB2, CPTADET, NOLIGRF, ACOMPTE, ASSPERT, PCA, GRUB, ALISSER, FRANRUB, CCRITLOC, CTSCAT, CCRITCOMP, AUTORISE, SAUTORISE, CAUTORISE, TYPEMDT, TASSPAR, TASSPRE, LGESHONO, /*SEUIL,*/ PRIME, CPRESTA, LACTIF, PCABAIL, ADFVAC)
SELECT CRUB, LRUB, CNATRUB, SENS, TPSPRE, RTOTAVIS, TEMREGUL, CMETHCAL, TEMBAIL, SORTI, QUITT, ECHEANCE, NOORD, ERUB, DDEBLOC, TRIG, CRUBTAX##1, /*NCOLEDIT,*/ EDITDEM, LOYPRIN, CTYPTAX, CTASS, PRELEV, NATAPL, DRUB, /*NCOLECRAN,*/ CMETARR, TEMIMP, RRUB, ARUB, NORDEC, LIBANNEXE, COMPVAC, CNATANA, TXEFFORT, CRUPTURE, REVERSE, AREVERSER, DECOMPTE, LIDR, LHONO, LGARANT, TRUB, BRUB, SRUB, CNUMI, PEREVISION, TRIMIND, CBASE, LOCCOP, PRUB, MRUB, CTRLBUD, CNATHON, CTRLEXO, HRUB, XRUB, LREVIS, FRUB, RTASS, PRIORO, PRIORT, CCHAPITRE, CLETTRF##1, CREGCPTE, HONAUTRE, REGREPART, REGRF, COPRO, LIBIS, NRUB, IRUB1, IRUB2, CPTADET, NOLIGRF, ACOMPTE, ASSPERT, PCA, GRUB, ALISSER, FRANRUB, CCRITLOC, CTSCAT, CCRITCOMP, AUTORISE, SAUTORISE, CAUTORISE, TYPEMDT, TASSPAR, TASSPRE, LGESHONO, /*SEUIL,*/ PRIME, CPRESTA, LACTIF, PCABAIL, ADFVAC
FROM ESTIA_SOURCE..RUB
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--RUBPER: TABLE DES PERIODES DE REGULARISATION PAR RUBRIQUE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('RUBPER', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_RUBPER
INSERT INTO ESTIA_RUBPER (CORG, CAGENCE, CGROUPE, DDEBPER, DFINPER, CRUB, CPRC, REGUL, TRIG, BCOPLOC, LIB, ANALYSE, COMPLEMENT, PARTIEL)
SELECT CORG, CAGENCE, CGROUPE, 
ISNULL(SUBSTRING(DDEBPER, 7, 2) + SUBSTRING(DDEBPER, 4, 2) + LEFT(DDEBPER, 2), '') AS DDEBPER, DFINPER, CRUB, CPRC, REGUL, TRIG, BCOPLOC, LIB, ANALYSE, COMPLEMENT, PARTIEL
FROM ESTIA_SOURCE..RUBPER
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--SCRITDP: TABLE DES SOUS-CRITERES DE DEPENSES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('SCRITDP', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_SCRITDP
INSERT INTO ESTIA_SCRITDP (CORG, CAGENCE, CGROUPE, CCRITDP, CSCRITDP, LSCRITDP, CBASE, CMETHCAL, CTVA, TRECUP, TXRECUP, PCHLOC, TREGUL, PEVOL, NIVQP, TRIG, TRECLOC, PRORATABASE, RECUPTX, DEDUCIMP, MDPA, REPRES, RCRITDP, RSCRITDP, CSTE, CRUB, MIGCOMPT)
SELECT CORG, CAGENCE, CGROUPE, CCRITDP, CSCRITDP, LSCRITDP, CBASE, CMETHCAL, CTVA, TRECUP, TXRECUP, REPLACE(PCHLOC, ',','.') AS PCHLOC, TREGUL, REPLACE(PEVOL, ',','.') AS PEVOL, NIVQP, TRIG, TRECLOC, PRORATABASE, RECUPTX, DEDUCIMP, MDPA, REPRES, RCRITDP, RSCRITDP, CSTE, CRUB, MIGCOMPT
FROM ESTIA_SOURCE..SCRITDP
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--SURFLOC: TABLE DES SURFACES DES LOTS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('SURFLOC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_SURFLOC
INSERT INTO ESTIA_SURFLOC (CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, SHAB, CSTE, DEFFET, SCORR, SCHAU, SGAR, SUTILE, SCUTILE, SANNEXE, DMAJ, CUTIL, COEF, TRIG, SREELLE, SIMPOS, CONVENT, MIGCOMPT, LOCAL_ID)
SELECT CORG, CAGENCE, CGROUPE, CIMMEUB, CLOCAL, REPLACE(SHAB, ',','.') AS SHAB, CSTE, 
ISNULL(CASE WHEN LEN(DEFFET) = 8 THEN convert(datetime, SUBSTRING(DEFFET, 7, 2) + substring(DEFFET, 4, 2) + substring(DEFFET, 1, 2), 103)
	 WHEN LEN(DEFFET) = 10 THEN convert(datetime, substring(DEFFET, 7, 4) + substring(DEFFET, 4, 2) + substring(DEFFET, 1, 2), 103) END, '') AS DEFFET, 
REPLACE(SCORR, ',','.') AS SCORR, REPLACE(SCHAU, ',','.') AS SCHAU, REPLACE(SGAR, ',','.') AS SGAR, REPLACE(SUTILE, ',','.') AS SUTILE, REPLACE(SCUTILE, ',','.') AS SCUTILE, REPLACE(SANNEXE, ',','.') AS SANNEXE, DMAJ, CUTIL, COEF, TRIG, REPLACE(SREELLE, ',','.') AS SREELLE, REPLACE(SIMPOS, ',','.') AS SIMPOS, CONVENT, MIGCOMPT, LOCAL_ID
FROM ESTIA_SOURCE..SURFLOC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


TRUNCATE TABLE ESTIA_TASS
INSERT INTO ESTIA_TASS (CMANDAT, CTASS, CTYPTASS, LACTIF, LINDOCC, LTASS,PRIORITE, TRIG)
SELECT CMANDAT, CTASS, CTYPTASS, LACTIF, LINDOCC, LTASS,PRIORITE, TRIG
FROM ESTIA_SOURCE..TASS
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TAUX: TABLE DES TAUX DE TAXES
TRUNCATE TABLE ESTIA_TAUX
INSERT INTO ESTIA_TAUX (CRUB, DDEB, DFIN, MONTANT, TRIG, LACTIF)
SELECT CRUB, DDEB, DFIN, REPLACE(MONTANT, ',','.') AS MONTANT, TRIG, LACTIF
FROM ESTIA_SOURCE..TAUX


--TIERS: TABLE DES TIERS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TIERS', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TIERS
INSERT INTO ESTIA_TIERS (CPOS, CTYPTIERS, DATNAI, CTIERS, PETIERS, PETYPTIERS, SIRET, CQC, RTIERS, LTIERS, RUE, COMMUNE, LBANQUE, BDIS, CPAYS, CONTACT, TEL, CTEL, TELECOP, TELEX, CQCCONT, CAPE, CSTATUT, CCOMM, ASCON, ASDAT, ASPOL, CCAGASSUR, CCODASSUR, NOM, PRENOM, POUM, INSEE, CSITUFA, NBENT, CPROF, CBANQUE, PRECONT, FONCONT, TELCONT, POSTCONT, FAXCONT, CGUICHET, NUMCPTE, RIB, CTYPPREL, DLAIJOUR, JPDLAI, CMODREG, CFONCTIO, LIEUNAI, TRIG, TRIGD, TELBUR, INTERNET, CAPITAL, RCS, NOIDENT, NBHEURE, PARTGRP, DCONV, NUMCONV, ADRCOMP, TVACEE, ASSPERT, MOIS, FREQASS, DERACPTE, LTIERS1, LTIERS2, MIGCOMPT, EXTIDENT, EXTPASSE, EXTACC, EXTVER, POUREV, CARTET, CARTEG, RATIERS, CODNAT, CLEIBAN, TIERS_ID, CTYPDECRF, DDEUNIQ, UNIQADRES, UNIQCOORD, ASDATFIN, LHEBERGE)
SELECT CPOS, CTYPTIERS, 
ISNULL(SUBSTRING(DATNAI, 7, 2) + SUBSTRING(DATNAI, 4, 2) + LEFT(DATNAI, 2), '') AS DATNAI, 
CTIERS, PETIERS, PETYPTIERS, SIRET, CQC, RTIERS, LTIERS, RUE, COMMUNE, LBANQUE, BDIS, CPAYS, CONTACT, TEL, CTEL, TELECOP, TELEX, CQCCONT, CAPE, CSTATUT, CCOMM, ASCON, ASDAT, ASPOL, CCAGASSUR, CCODASSUR, NOM, PRENOM, POUM, INSEE, CSITUFA, NBENT, CPROF, CBANQUE, PRECONT, FONCONT, TELCONT, POSTCONT, FAXCONT, CGUICHET, NUMCPTE, RIB, CTYPPREL, DLAIJOUR, JPDLAI, CMODREG, CFONCTIO, LIEUNAI, TRIG, TRIGD, TELBUR, INTERNET, CAPITAL, RCS, NOIDENT, NBHEURE, PARTGRP, DCONV, NUMCONV, ADRCOMP, TVACEE, ASSPERT, MOIS, FREQASS, DERACPTE, LTIERS1, LTIERS2, MIGCOMPT, EXTIDENT, EXTPASSE, EXTACC, EXTVER, POUREV, CARTET, CARTEG, RATIERS, CODNAT, CLEIBAN, TIERS_ID, CTYPDECRF, DDEUNIQ, UNIQADRES, UNIQCOORD, ASDATFIN, LHEBERGE
FROM ESTIA_SOURCE..TIERS
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TIERSF: TABLE DES TIERS FOURNISSEURS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TIERSF', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TIERSF
INSERT INTO ESTIA_TIERSF (CTIERS, CTYPTIERS, CTYPFACT, NBFACT, CMODREG, CTYPDAT, CDECALA, CDECALD, DUREE, LBANQUE, GUICHET, CBANQUE, NUMCPTE, RIB, REGTVA, CTYPREL, PERREL, ECHREL, CCATEG, CTYPPREL, TRIG, UTIL, UNLETTRAG, BLCFAC, MIGCOMPT, CODNAT, CLEIBAN, COORDBANQ_ID)
SELECT CTIERS, CTYPTIERS, CTYPFACT, NBFACT, CMODREG, CTYPDAT, CDECALA, CDECALD, DUREE, LBANQUE, GUICHET, CBANQUE, NUMCPTE, RIB, REGTVA, CTYPREL, PERREL, ECHREL, CCATEG, CTYPPREL, TRIG, UTIL, UNLETTRAG, BLCFAC, MIGCOMPT, CODNAT, CLEIBAN, COORDBANQ_ID
FROM ESTIA_SOURCE..TIERSF
WHERE CTIERS IS NOT NULL
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TRAIT: TABLE DES ORIGINES DE TRAITEMENT
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TRAIT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TRAIT
INSERT INTO ESTIA_TRAIT (CTRAIT, LTRAIT, TASS, TRIG, AUTORISE, SAUTORISE, CAUTORISE)
SELECT CTRAIT, LTRAIT, TASS, TRIG, AUTORISE, SAUTORISE, CAUTORISE
FROM ESTIA_SOURCE..TRAIT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TSCAT: TABLE DES TANCHES DES LA GESTION DES OPERATIONS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TRANCHE', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TRANCHE
INSERT INTO ESTIA_TRANCHE (CORG, CMARCHE, CTRANCHE, LTRANCHE, DDEXEC, DFINPREV, FERMCOND, DELAI, TYPDEL, DFEXEC, DDD, TRIG, COPE, DPRELIM, DAUTOENGA, DDOC, DCONFORM, DFGEST, DORDS, DRESEPT, DACHEV, DDAT, DCLOTU, CSTEOM, CODEOM, LASM, LASMPRORA, LASMIXTE, ASSUTVA, PRORATA, DPROG, CETAT, TEMIGRA, TXPRESTA, CAVOPE, RENOUV, CMODCOMP, GESTCOMP)
SELECT CORG, CMARCHE, CTRANCHE, LTRANCHE, 
ISNULL(SUBSTRING(DDEXEC, 7, 2) + SUBSTRING(DDEXEC, 4, 2) + LEFT(DDEXEC, 2), '') AS DDEXEC, DFINPREV, FERMCOND, DELAI, TYPDEL, DFEXEC, DDD, TRIG, COPE, DPRELIM, DAUTOENGA, DDOC, DCONFORM, DFGEST, 
ISNULL(SUBSTRING(DORDS, 7, 2) + SUBSTRING(DORDS, 4, 2) + LEFT(DORDS, 2), '') AS DORDS, DRESEPT, DACHEV, DDAT, DCLOTU, CSTEOM, CODEOM, LASM, LASMPRORA, LASMIXTE, ASSUTVA, PRORATA, DPROG, CETAT, TEMIGRA, TXPRESTA, CAVOPE, RENOUV, CMODCOMP, GESTCOMP
FROM ESTIA_SOURCE..TRANCHE
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TSCAT: TABLE DES CATEGORIES DE TIERS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TSCAT', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TSCAT
INSERT INTO ESTIA_TSCAT (LISTORG, CTSCAT, LTSCAT, CTYPTIERS, LETTRAG, DERCLO, BALEDIT, TRIG, SLET, LISTAGE, LACTIF)
SELECT LISTORG, CTSCAT, LTSCAT, CTYPTIERS, LETTRAG, DERCLO, BALEDIT, TRIG, SLET, LISTAGE, LACTIF
FROM ESTIA_SOURCE..TSCAT
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TSLIEN: TABLE DES CATEGORIES DE TIERS D'UN TIERS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TSLIEN', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TSLIEN
INSERT INTO ESTIA_TSLIEN (CTYPTIERS, CTIERS, CTSCAT, CORG, TRIG, LETT)
SELECT CTYPTIERS, CTIERS, CTSCAT, CORG, TRIG, LETT
FROM ESTIA_SOURCE..TSLIEN
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TVA: TABLE DES TYPE DE TVA
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TVA', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TVA
INSERT INTO ESTIA_TVA (CTVA, LTVA, TTVA, TRIG, LACTIF)
SELECT CTVA, LTVA, REPLACE(TTVA, ',','.') AS TTVA, TRIG, LACTIF
FROM ESTIA_SOURCE..TVA
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TYPCOM: TABLE DES TYPES DE SOUS-COMPTES CLIENTS ET FOURNISSEURS
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TYPCOM', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TYPCOM
INSERT INTO ESTIA_TYPCOM (CTYPCOM, LTYPCOM, TRIG, UTILPI, LACTIF)
SELECT CTYPCOM, LTYPCOM, TRIG, UTILPI, LACTIF
FROM ESTIA_SOURCE..TYPCOM
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TYPLOG: TABLE DES TYPE DE LOCAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TYPLOG', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TYPLOG
INSERT INTO ESTIA_TYPLOG (CTYPLOG, LTYPLOG, TRIG, TRIGD, NBPIEC, CTYPCIL, PEGAS, TSOUMTAX, TYPUSALO, LACTIF)
SELECT CTYPLOG, LTYPLOG, TRIG, TRIGD, NBPIEC, CTYPCIL, PEGAS, TSOUMTAX, TYPUSALO, LACTIF
FROM ESTIA_SOURCE..TYPLOG
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--TYPROPR: TABLE DE PLAN DE COMPTE PAR TYPE DE PROPRIETAIRE
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('TYPROPR', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_TYPROPR
INSERT INTO ESTIA_TYPROPR (CMANDAT, CTIERS, CTYPTIERS, CTYPROPR, DARRETE, DDEB, DFIN, MIGCOMPT, TRIG, TYPROPR_ID)
SELECT CMANDAT, CTIERS, CTYPTIERS, CTYPROPR, DARRETE, DDEB, DFIN, MIGCOMPT, TRIG, TYPROPR_ID
FROM ESTIA_SOURCE..TYPROPR
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--USALOC: TABLE DES USAGES DE LOCAUX
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('USALOC', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_USALOC
INSERT INTO ESTIA_USALOC (CUSALOC, LUSALOC, TRIG, TRIGD, PEGAS, TYPUSALO, TSOUMTAX, NBMMINI, LACTIF)
SELECT CUSALOC, LUSALOC, TRIG, TRIGD, PEGAS, TYPUSALO, TSOUMTAX, NBMMINI, LACTIF
FROM ESTIA_SOURCE..USALOC
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG


--VENTPCHA: TABLE DES VENTILATIONS DE FACTURES
INSERT INTO L_REPURERATION_ESTIA (NOM_TABLE, IND_SUCCES, DT_DEBUT) VALUES ('VENTPCHA', 'N', GETDATE())
SET @ID_LOG = @@IDENTITY
TRUNCATE TABLE ESTIA_VENTPCHA
INSERT INTO ESTIA_VENTPCHA (CORG, CTIERS, CCONTFRS, CVENTPCHA, LVENTPCHA, CGROUPE, CCRITDP, CSCRITDP, FFVENT, TXVENT, ZAGENCE, PRORATATVA, CLE, CTVA, TRIG, CNATECH, CSECTANA, CSECTREG, POURC, PRORATA, PRINCIPAL, CCONTRASS, MIGCOMPT)
SELECT CORG, CTIERS, CCONTFRS, CVENTPCHA, LVENTPCHA, CGROUPE, CCRITDP, CSCRITDP, REPLACE(FFVENT, ',','.') AS FFVENT, REPLACE(TXVENT, ',','.') AS TXVENT, ZAGENCE, REPLACE(PRORATATVA, ',','.') AS PRORATATVA, CLE, CTVA, TRIG, CNATECH, CSECTANA, CSECTREG, REPLACE(POURC, ',','.') AS POURC, REPLACE(PRORATA, ',','.') AS PRORATA, PRINCIPAL, CCONTRASS, MIGCOMPT
from ESTIA_SOURCE..VENTPCHA
SET @NB = @@ROWCOUNT
UPDATE L_REPURERATION_ESTIA SET IND_SUCCES = 'O', DT_FIN = GETDATE(), NB_LIGNES = @NB WHERE ID_LOG = @ID_LOG

END